{
  "hash": "046df423149e4261013d827b900c547c",
  "result": {
    "markdown": "---\ntitle: \"Simulation of Realized Infection Risk\"\ndescription: \"simulate a probability distribution of risk\"\nauthor:\n  - name: Kayla Kauffman\n    url: https://https://kmkauffm.github.io/\n    orcid: 0000-0002-4897-9428\ndate: 2023-11-29\ncategories: [R, code, simulations] # self-defined categories\ncitation: \n  url: https://https://kmkauffm.github.io//posts/2023-11-29-realizedrisk/ \nimage: schema.png\ndraft: true # setting this to `true` will prevent your post from appearing on your listing page until you're ready!\n---\n\n::: {.cell}\n\n:::\n\n\n## Background  \nRisk maps are used to describe the places where people (or animals) are most likely to be exposed to infectious disease. However, the time an individual spends in a place is not the only predictor of infection. The activity a person does in a location may influence if they are exposed to the disease, for example a person wearing shoes in an environment with a lot of soil transmitted helminths is at low infection risk because they are wearing shoes, thus not directly exposed to the contaminated soil. The person's immunity or susceptibility to an infection also influences their infection risk.  \nBefore creating a model with real data mapping people's land use to their infection status I want to build a simulation of how I think the model will work. First, I want to compare people that infection probabilities in people \"vibrating\" in place (Brownian motion) and to people traversing the landscape in corridors (Levian motion). I'll then use this model to test how much susceptibility can vary before there is no correlation between the time people spend in risky places and their infection risk. *Asking: Do risk maps even work given individual heterogenetiy in susceptibility?*  \n\n## Make a Risk Map  \n\nRisk across the landscape likely has a lot of spatial autocorrelation and relates to underlying environmental features. Instead of simulating this, I am using the spDataLarge elevation raster data the Zion National Park area as the *risk map*.  \n\n\n::: {.cell}\n\n```{.r .cell-code}\nriskmap <- rast(system.file(\"raster/srtm.tif\", package = \"spDataLarge\"))\n\n## change into utm so easier to do the simulated tracks\nriskmap <- project(riskmap, \"EPSG:26912\")\n\n## make values [0,1]\nriskmap <- riskmap/2891.000\n\n## make resolution lower so things run quickly\nriskmap <- aggregate(riskmap, fact=5, fun=\"mean\")\n\n## make square\ntmp <- vect(ext(riskmap)-5000, crs=crs(riskmap))\nriskmap <- crop(riskmap, tmp)\n\n## quick plot\nplot(riskmap)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n\n```{.r .cell-code}\nriskmap\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nclass       : SpatRaster \ndimensions  : 79, 61, 1  (nrow, ncol, nlyr)\nresolution  : 417.6664, 417.6664  (x, y)\nextent      : 306074, 331551.7, 4116123, 4149119  (xmin, xmax, ymin, ymax)\ncoord. ref. : NAD83 / UTM zone 12N (EPSG:26912) \nsource(s)   : memory\nname        :      srtm \nmin value   : 0.3725258 \nmax value   : 0.9733700 \n```\n:::\n\n```{.r .cell-code}\n## find dimensions of area so can choose step lengths\nrisk_bb <- ext(riskmap)\n# risk_bb[2]-risk_bb[1]\n# risk_bb[4]-risk_bb[3]\n## ~35km x 43km\n## make slightly smaller so indivdiuals not on edge\nrisk_bb <- risk_bb + c(5000, -5000, 5000, -5000)\n\n## save cell size\ncell_size = res(riskmap)[1]\n\n## save crs\ncrs_risk <- crs(riskmap)\n```\n:::\n\n\n## Simulate movement  \nhttps://cran.r-project.org/web/packages/SiMRiv/vignettes/SiMRiv.pdf\n\n### Brownian  \nSimulate vibrating, Brownian movement of individuals basically vibrating in place with each individuals' starting location distributed throughout the risk map area  \n\n\n::: {.cell}\n\n```{.r .cell-code}\n## one type of movement with a random walk with step lengths relative \nrand.walker <- species(state(concentration = 0, #random\n                             pwind = perceptualRange(\"gaussian\", 1),\n                             steplen = 10,\n                             name = \"tight_random\"))\n\n## generate random starting points (might change to regular or increase n)\n### avoid edges\naoi <- buffer(vect(ext(riskmap)),-2000)\naoi <- crop(riskmap, aoi)\n\nstart_coord <- spatSample(aoi, \n                          100,\n                  method = \"random\",\n                  as.points = TRUE,\n                  values = F)\nplot(riskmap);points(start_coord)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n\n```{.r .cell-code}\n## need those as a nx2 matrix\nstart_coord_mat <- as.matrix(as.data.frame(start_coord, geom=\"xy\"))\n\n## simulate single state walks of 1000 steps\nsim.rw <- list()\nfor (i in 1:100) {\n  tmp <- simulate(rand.walker, 1000,\n                   coords = start_coord_mat[i,])\n  sim.rw[[i]] <- cbind(tmp[,1], tmp[,2])\n}\n\n### make into vect\nsim.rw.sp1 <- lapply(sim.rw, vect, crs = crs_risk)\n## plot it\n# plot(sim.rw.sp[[1]])\n# plot(riskmap); lines(sim.rw[[1]])\nplot(riskmap); invisible(lapply(sim.rw, FUN = lines))\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-3-2.png){width=672}\n:::\n:::\n\n\n### Levian (Correlated Walks)  \nNeed to make a resistance raster to get correlated walk\n\n::: {.cell}\n\n```{.r .cell-code}\nLevyWalker <- species(\n\t(state.RW() * 100 + 10) + (state.CRW(0.97) * 500 + 50)\n, transitionMatrix(0.005, 0.001))\n\n## basemaps for resistance\nlandcover <- resistanceFromShape(\nsystem.file(\"doc/landcover.shp\", package=\"SiMRiv\")\n, res = 50, field = \"coverclass\", mapvalues = c(\n\"forest\" = 0.5, \"urban\" = 1, \"dam\" = 0\n, \"shrubland\" = 0.75), background = 0.95)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nReading layer `landcover' from data source \n  `C:\\Users\\Kayla\\AppData\\Local\\R\\win-library\\4.3\\SiMRiv\\doc\\landcover.shp' \n  using driver `ESRI Shapefile'\nSimple feature collection with 8 features and 1 field\nGeometry type: POLYGON\nDimension:     XY\nBounding box:  xmin: 684645.8 ymin: 4618784 xmax: 697081.3 ymax: 4639516\nProjected CRS: WGS 84 / UTM zone 29N\n```\n:::\n\n```{.r .cell-code}\nriver.shape <- sf::st_read(system.file(\"doc/river-sample.shp\", package=\"SiMRiv\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nReading layer `river-sample' from data source \n  `C:\\Users\\Kayla\\AppData\\Local\\R\\win-library\\4.3\\SiMRiv\\doc\\river-sample.shp' \n  using driver `ESRI Shapefile'\nSimple feature collection with 220 features and 1 field\nGeometry type: LINESTRING\nDimension:     XY\nBounding box:  xmin: 678213.6 ymin: 4606303 xmax: 698782.2 ymax: 4649171\nProjected CRS: WGS 84 / UTM zone 29N\n```\n:::\n\n```{.r .cell-code}\n## resistence surface\nresistance <- resistanceFromShape(system.file(\"doc/river-sample.shp\", package=\"SiMRiv\"),\n                                       baseRaster = landcover,\n                                       buffer = 100, field = 0,\n                                       background = 0.95, margin = 3000)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nReading layer `river-sample' from data source \n  `C:\\Users\\Kayla\\AppData\\Local\\R\\win-library\\4.3\\SiMRiv\\doc\\river-sample.shp' \n  using driver `ESRI Shapefile'\nSimple feature collection with 220 features and 1 field\nGeometry type: LINESTRING\nDimension:     XY\nBounding box:  xmin: 678213.6 ymin: 4606303 xmax: 698782.2 ymax: 4649171\nProjected CRS: WGS 84 / UTM zone 29N\n```\n:::\n\n```{.r .cell-code}\n# buffer here is just some magical function to convert river\n# order into a meaningful value in the [0, 1] range!\n\nplot(resistance, axes = F)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n\n```{.r .cell-code}\nresistance\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nclass      : RasterLayer \ndimensions : 921, 476, 438396  (nrow, ncol, ncell)\nresolution : 50, 50  (x, y)\nextent     : 676595.8, 700395.8, 4604716, 4650766  (xmin, xmax, ymin, ymax)\ncrs        : NA \nsource     : memory\nnames      : layer \nvalues     : 0, 1  (min, max)\n```\n:::\n\n```{.r .cell-code}\n## change that to be in the same spot as the riskmap\nnew.resist <- rast(extent=ext(aoi),\n               nrow=dim(resistance)[1], ncol=dim(resistance)[2],\n               crs = crs_risk,\n               vals = values(resistance))\nnew.resist <- aggregate(new.resist, fact = 10, fun = \"mean\", na.rm = TRUE)\nplot(new.resist)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-4-2.png){width=672}\n:::\n\n```{.r .cell-code}\n## new starting coords in areas of low resistance so don't get stuck\ninit = xyFromCell(new.resist, sample(which(values(new.resist) <0.2), 100, replace=T))\n## simulate\nsim.rw2 <- list()\nfor (i in 1:100) {\n  tmp <- simulate(LevyWalker, 1000,\n                  resist = raster(new.resist),\n                   coords = init[i,])\n  sim.rw2[[i]] <- cbind(tmp[,1], tmp[,2])\n}\n\n### make into vect\nsim.rw.sp2 <- lapply(sim.rw2, vect, crs = crs_risk)\n\n## plot it\nplot(riskmap); invisible(lapply(sim.rw2, FUN = lines))\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-4-3.png){width=672}\n:::\n:::\n\n\n## Homeranges  \nfor each individual calculate homerange (KD) \n\n::: {.cell}\n\n```{.r .cell-code}\n## grid of study area\ntmp <- vect(ext(riskmap), crs=crs_risk)\nstudygrid <- SpatialKDE::create_raster(st_as_sf(tmp),\n                                       cell_size = cell_size)\n## make points into sf\nsim1sf <- st_as_sf(sim.rw.sp2[[1]], geom=\"xy\")\n\n## find kde\nkde <- SpatialKDE::kde(sim1sf, band_width = 10000, scaled = T, grid = studygrid)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n```\n:::\n\n```{.r .cell-code}\n## crop to area where the individual was so not tiny\nkde.sm <- crop(kde, st_buffer(sim1sf, 2000))\nrisk.sm <- crop(riskmap, st_buffer(sim1sf, 2000))\n\n## calculate risk\nkde.risk <- rast(kde.sm)*risk.sm\n\n## check in ball park\nsum(values(risk.sm))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 259.9122\n```\n:::\n\n```{.r .cell-code}\nsum(values(rast(kde.sm)))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 0.01816479\n```\n:::\n\n```{.r .cell-code}\nsum(values(risk.sm)*values(rast(kde.sm)))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 0.01323637\n```\n:::\n\n```{.r .cell-code}\nsum(values(kde.risk))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 0.01323637\n```\n:::\n\n```{.r .cell-code}\n## plots to demo\nggplot()+\n  tidyterra::geom_spatraster(data=risk.sm) +\n  scale_fill_viridis_c(option=\"A\", direction = -1) +\n  labs(fill = \"landscape risk\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n\n```{.r .cell-code}\nggplot()+\n  tidyterra::geom_spatraster(data=rast(kde.sm)) +\n  scale_fill_viridis_c(option=\"A\", direction = -1) +\n  labs(fill = \"exposure\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-5-2.png){width=672}\n:::\n\n```{.r .cell-code}\nggplot()+\n  tidyterra::geom_spatraster(data=kde.risk) +\n  scale_fill_viridis_c(option=\"A\", direction = -1) +\n  labs(fill = \"inf. probability\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-5-3.png){width=672}\n:::\n\n```{.r .cell-code}\n#### then redo on study grid so\nrm(tmp, studygrid, sim1sf, kde, kde.sm, risk.sm, kde.risk)\n```\n:::\n\n\n\nthen multiply their homerange by the \"risk\" in each cell\n\nPut that in a function and run for everyone\n\n::: {.cell}\n\n```{.r .cell-code}\n## make a function\nmeasure_risk <- function(X, riskmap){\n  ## grid of study area\n  tmp <- vect(ext(riskmap), crs=crs_risk)\n  studygrid <- SpatialKDE::create_raster(st_as_sf(tmp),\n                                         cell_size = cell_size)\n  ## make points into sf\n  sim1sf <- lapply(X, st_as_sf, geom=\"xy\")\n  ## find kde\n  kde <- lapply(sim1sf, SpatialKDE::kde, band_width = 100, scaled = T, grid = studygrid)\n  ## convert Raster to SpatRast\n  kde <- lapply(kde, rast)\n  \n  ## multiply time in cell (kde) * cell's risk\n  new <- lapply(kde, function(i) i*riskmap)\n  ## sum of values in each layer are individual's risk\n  indiv_risk <- lapply(new, function(i) sum(values(i), na.rm=T))\n  \n  ## return a vector\n  unlist(indiv_risk)\n}\n```\n:::\n\n\nFind probabily of expsoure for each individual\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n```\n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n```\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n\nDone: [--------------------------------------------------------------------] .\nDone: [====================================================================] .\n                                                                              \n```\n:::\n:::\n\n\nValues in random walk \n\n::: {.cell}\n\n```{.r .cell-code}\n## look at some of the values\nindiv_risk1[1:10]\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n [1] 0.03092283 0.01558403 0.04232516 0.05219774 0.03587051 0.02589272\n [7] 0.01809209 0.15778400 0.10425742 0.02810025\n```\n:::\n\n```{.r .cell-code}\nrange(indiv_risk1)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 0.004528794 0.189178801\n```\n:::\n:::\n\n\nValues in corridor walk\n\n::: {.cell}\n\n```{.r .cell-code}\nindiv_risk2[1:10]\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n [1] 0.03149273 0.04095521 0.01706546 0.01999374 0.01930194 0.04478892\n [7] 0.09564420 0.02857252 0.01897320 0.06463020\n```\n:::\n\n```{.r .cell-code}\nrange(indiv_risk2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 0.0008798587 0.1002468783\n```\n:::\n:::\n\n\n## Assisgn susceptibility  \nindividuals should have variable susceptiblity so that not everyone's probabilty of infection equals their sum\n\n::: {.cell}\n\n```{.r .cell-code}\nsusceptbility = runif(100, 0.4, 0.5)\n```\n:::\n\ndataframes for the 2 types of exposures\n\n::: {.cell}\n\n```{.r .cell-code}\nrw_risk <- data.frame(\n  id = 100:199,\n  exp_risk = indiv_risk1,\n  susceptbility = susceptbility\n)\n\ncw_risk <- data.frame(\n  id = 100:199,\n  exp_risk = indiv_risk1,\n  susceptbility = susceptbility\n)\n```\n:::\n\n\n## trials   \nCompare probability of infection as a function of susceptibility alone (i.e. indiv stochasiticity; Null) to susceptibility * exposure risk (i.e. does adding info of exposure risk help)?? Not sure where I am going here....need to reread note on the origional idea\n\n::: {.cell}\n\n```{.r .cell-code}\n## random walk indiv's should just correlate with background (e_inf)\nrw_risk$s_inf <- rbinom(100, 1, rw_risk$susceptbility*mean(rw_risk$exp_risk))\nrw_risk$e_inf <- rbinom(100, 1, rw_risk$susceptbility*rw_risk$exp_risk)\n\np1 <- ggplot(rw_risk) +\n  geom_point(aes(x=exp_risk, y=s_inf))+\n  geom_smooth(aes(x=exp_risk, y=s_inf, col=\"without risk\"),\n              col=\"#619CFF\",\n              se=F,\n              method=\"glm\",\n              method.args=list(family=\"binomial\")) +\n  labs(x=\"Exposure risk\", y = \"infection\",\n       col=NULL,\n       title=\"Susceptibility only\")\n\np2 <- ggplot(rw_risk) +\n  geom_point(aes(x=exp_risk, y=e_inf))+\n  geom_smooth(aes(x=exp_risk, y=e_inf),\n              col=\"#F8766D\",\n              se=F,\n              method=\"glm\",\n              method.args=list(family=\"binomial\")) +\n  labs(x=\"Exposure risk\", y = \"infection\",\n       col=NULL,\n       title=\"Susceptibility * Risk\")\np3 <- ggplot(rw_risk) +\n  geom_smooth(aes(x=exp_risk, y=s_inf, col=\"without risk\"),\n              se=F,\n              method=\"glm\",\n              method.args=list(family=\"binomial\")) +\n  geom_smooth(aes(x=exp_risk, y=e_inf, col=\"with risk\"),\n              se=F,\n              method=\"glm\",\n              method.args=list(family=\"binomial\")) +\n  labs(x=\"Exposure risk\", y = \"infection\",\n       col=NULL,\n       title=\"Comparison\")\n\n((p1 | p2)/ p3) + plot_layout(guides = 'collect')\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-12-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n## random walk indiv's should just correlate with background (e_inf)\ncw_risk$s_inf <- rbinom(100, 1, cw_risk$susceptbility*mean(cw_risk$exp_risk))\ncw_risk$e_inf <- rbinom(100, 1, cw_risk$susceptbility*cw_risk$exp_risk)\n\np1 <- ggplot(cw_risk) +\n  geom_point(aes(x=exp_risk, y=s_inf))+\n  geom_smooth(aes(x=exp_risk, y=s_inf, col=\"without risk\"),\n              col=\"#619CFF\",\n              se=F,\n              method=\"glm\",\n              method.args=list(family=\"binomial\")) +\n  labs(x=\"Exposure risk\", y = \"infection\",\n       col=NULL,\n       title=\"Susceptibility only\")\n\np2 <- ggplot(cw_risk) +\n  geom_point(aes(x=exp_risk, y=e_inf))+\n  geom_smooth(aes(x=exp_risk, y=e_inf),\n              col=\"#F8766D\",\n              se=F,\n              method=\"glm\",\n              method.args=list(family=\"binomial\")) +\n  labs(x=\"Exposure risk\", y = \"infection\",\n       col=NULL,\n       title=\"Susceptibility * Risk\")\np3 <- ggplot(cw_risk) +\n  geom_smooth(aes(x=exp_risk, y=s_inf, col=\"without risk\"),\n              se=F,\n              method=\"glm\",\n              method.args=list(family=\"binomial\")) +\n  geom_smooth(aes(x=exp_risk, y=e_inf, col=\"with risk\"),\n              se=F,\n              method=\"glm\",\n              method.args=list(family=\"binomial\")) +\n  labs(x=\"Exposure risk\", y = \"infection\",\n       col=NULL,\n       title=\"Comparison\")\n\n((p1 | p2)/ p3) + plot_layout(guides = 'collect')\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-13-1.png){width=672}\n:::\n:::\n\n\n### replicate that many times  \n\n::: {.cell}\n\n```{.r .cell-code}\ntrials <- 100\n```\n:::\n\n\nBrownian\n\n::: {.cell}\n\n```{.r .cell-code}\n## random walk indiv's should just correlate with background (e_inf)\ns_inf <- replicate(trials, rbinom(100, 1, rw_risk$susceptbility*mean(rw_risk$exp_risk)))\ns_inf <- rowSums(s_inf)/trials\nrange(s_inf)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 0.00 0.06\n```\n:::\n\n```{.r .cell-code}\ne_inf <- replicate(trials, rbinom(100, 1, rw_risk$susceptbility*rw_risk$exp_risk))\ne_inf <- rowSums(e_inf)/trials\nrange(e_inf)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 0.00 0.12\n```\n:::\n\n```{.r .cell-code}\nrw_risk$s_inf <- s_inf\nrw_risk$e_inf <- e_inf\n\np1 <- ggplot(rw_risk) +\n  geom_point(aes(x=exp_risk, y=s_inf))+\n  geom_smooth(aes(x=exp_risk, y=s_inf, col=\"without risk\"),\n              col=\"#619CFF\",\n              se=F,\n              method=\"glm\") +\n  labs(x=\"Exposure risk\", y = \"infection\",\n       col=NULL,\n       title=\"Susceptibility only\")\n\np2 <- ggplot(rw_risk) +\n  geom_point(aes(x=exp_risk, y=e_inf))+\n  geom_smooth(aes(x=exp_risk, y=e_inf),\n              col=\"#F8766D\",\n              se=F,\n              method=\"glm\") +\n  labs(x=\"Exposure risk\", y = \"infection\",\n       col=NULL,\n       title=\"Susceptibility * Risk\")\np3 <- ggplot(rw_risk) +\n  geom_smooth(aes(x=exp_risk, y=s_inf, col=\"without risk\"),\n              se=F,\n              method=\"glm\") +\n  geom_smooth(aes(x=exp_risk, y=e_inf, col=\"with risk\"),\n              se=F,\n              method=\"glm\") +\n  labs(x=\"Exposure risk\", y = \"infection\",\n       col=NULL,\n       title=\"Comparison\")\n\n((p1 | p2)/ p3) + plot_layout(guides = 'collect')\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n`geom_smooth()` using formula = 'y ~ x'\n`geom_smooth()` using formula = 'y ~ x'\n`geom_smooth()` using formula = 'y ~ x'\n`geom_smooth()` using formula = 'y ~ x'\n```\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-15-1.png){width=672}\n:::\n:::\n\n\nCorridor \n\n::: {.cell}\n\n```{.r .cell-code}\n## random walk indiv's should just correlate with background (e_inf)\ns_inf <- replicate(trials, rbinom(100, 1, cw_risk$susceptbility*mean(cw_risk$exp_risk)))\ns_inf <- rowSums(s_inf)/trials\nrange(s_inf)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 0.00 0.05\n```\n:::\n\n```{.r .cell-code}\ne_inf <- replicate(trials, rbinom(100, 1, cw_risk$susceptbility*cw_risk$exp_risk))\ne_inf <- rowSums(e_inf)/trials\nrange(e_inf)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 0.00 0.09\n```\n:::\n\n```{.r .cell-code}\ncw_risk$s_inf <- s_inf\ncw_risk$e_inf <- e_inf\n\np1 <- ggplot(cw_risk) +\n  geom_point(aes(x=exp_risk, y=s_inf))+\n  geom_smooth(aes(x=exp_risk, y=s_inf, col=\"without risk\"),\n              col=\"#619CFF\",\n              se=F,\n              method=\"glm\") +\n  labs(x=\"Exposure risk\", y = \"infection\",\n       col=NULL,\n       title=\"Susceptibility only\")\n\np2 <- ggplot(cw_risk) +\n  geom_point(aes(x=exp_risk, y=e_inf))+\n  geom_smooth(aes(x=exp_risk, y=e_inf),\n              col=\"#F8766D\",\n              se=F,\n              method=\"glm\") +\n  labs(x=\"Exposure risk\", y = \"infection\",\n       col=NULL,\n       title=\"Susceptibility * Risk\")\np3 <- ggplot(cw_risk) +\n  geom_smooth(aes(x=exp_risk, y=s_inf, col=\"without risk\"),\n              se=F,\n              method=\"glm\") +\n  geom_smooth(aes(x=exp_risk, y=e_inf, col=\"with risk\"),\n              se=F,\n              method=\"glm\") +\n  labs(x=\"Exposure risk\", y = \"infection\",\n       col=NULL,\n       title=\"Comparison\")\n\n((p1 | p2)/ p3) + plot_layout(guides = 'collect')\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n`geom_smooth()` using formula = 'y ~ x'\n`geom_smooth()` using formula = 'y ~ x'\n`geom_smooth()` using formula = 'y ~ x'\n`geom_smooth()` using formula = 'y ~ x'\n```\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-16-1.png){width=672}\n:::\n:::\n\n\ncompare the fit of the susceptibility * risk for the two types of walks\n\n::: {.cell}\n\n```{.r .cell-code}\nm1 <- lm(e_inf ~ exp_risk, data=rw_risk)\nm2 <- lm(e_inf ~ exp_risk, data=cw_risk)\n\nsummary(m1)$r.squared\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 0.6199239\n```\n:::\n\n```{.r .cell-code}\nsummary(m2)$r.squared\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 0.552703\n```\n:::\n:::\n\nIt is worse with more variability in movement (corridor walk) but this is to be expected.\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}