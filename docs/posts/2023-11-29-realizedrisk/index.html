<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Kayla Kauffman">
<meta name="dcterms.date" content="2023-12-15">
<meta name="description" content="simulate a probability distribution of risk">

<title>Kayla Kauffman - Simulation of Realized Infection Risk</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../../styles.css">
</head>

<body class="floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Kayla Kauffman</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html" rel="" target="">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../publications.html" rel="" target="">
 <span class="menu-text">Publications</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../research.html" rel="" target="">
 <span class="menu-text">Projects</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../posts.html" rel="" target="">
 <span class="menu-text">Blog</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools ms-auto tools-wide">
    <a href="https://github.com/kmkauffm" title="Github" class="quarto-navigation-tool px-1" aria-label="Github"><i class="bi bi-github"></i></a>
    <a href="mailto:kaylakauffman@ucsb.edu" title="Email" class="quarto-navigation-tool px-1" aria-label="Email"><i class="bi bi-envelope"></i></a>
    <a href="../../qrcode.html" title="qrcode" class="quarto-navigation-tool px-1" aria-label="qrcode"><i class="bi bi-share"></i></a>
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default toc-left page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <div class="quarto-title-block"><div><h1 class="title">Simulation of Realized Infection Risk</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
                  <div>
        <div class="description">
          simulate a probability distribution of risk
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">R</div>
                <div class="quarto-category">code</div>
                <div class="quarto-category">simulations</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p><a href="https://https://kmkauffm.github.io/">Kayla Kauffman</a> <a href="https://orcid.org/0000-0002-4897-9428" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a></p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">December 15, 2023</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#risk-map" id="toc-risk-map" class="nav-link" data-scroll-target="#risk-map">Risk Map</a></li>
  <li><a href="#single-simulation" id="toc-single-simulation" class="nav-link" data-scroll-target="#single-simulation">Single simulation</a>
  <ul class="collapse">
  <li><a href="#simulate-movement" id="toc-simulate-movement" class="nav-link" data-scroll-target="#simulate-movement">Simulate movement</a>
  <ul class="collapse">
  <li><a href="#simple-random-walk" id="toc-simple-random-walk" class="nav-link" data-scroll-target="#simple-random-walk">Simple random walk</a></li>
  <li><a href="#correlated-walks" id="toc-correlated-walks" class="nav-link" data-scroll-target="#correlated-walks">Correlated walks</a></li>
  </ul></li>
  <li><a href="#exposure-risk" id="toc-exposure-risk" class="nav-link" data-scroll-target="#exposure-risk">Exposure risk</a></li>
  <li><a href="#assisgn-susceptibility" id="toc-assisgn-susceptibility" class="nav-link" data-scroll-target="#assisgn-susceptibility">Assisgn susceptibility</a></li>
  <li><a href="#results" id="toc-results" class="nav-link" data-scroll-target="#results">Results</a></li>
  </ul></li>
  <li><a href="#large-simulation" id="toc-large-simulation" class="nav-link" data-scroll-target="#large-simulation">Large Simulation</a></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">Conclusion</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  </ul>
</nav>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>My research broadly addresses how land use change impact zoonotic disease sharing patterns between wildlife, domestic animals and people. One aspect of this research delves into how well a landscape of risk <span class="citation" data-cites="weinstein2018">(<a href="#ref-weinstein2018" role="doc-biblioref">Weinstein, Buck, and Young 2018</a>)</span> can be predicted across space and time <span class="citation" data-cites="albery2022">(<a href="#ref-albery2022" role="doc-biblioref">Albery et al. 2022</a>)</span>, and if people that spend more time in areas of high pathogen prevalence on the landscape are more likely to be infected with that parasite. The landscape of risk is the variation in pathogen density or pressure across the landscape, and the underlying environmental characteristics that permit pathogen persistence and onward transmission to susceptible individuals visiting that area (e.g., <span class="citation" data-cites="titcomb2021">(<a href="#ref-titcomb2021" role="doc-biblioref">Titcomb et al. 2021</a>)</span>).</p>
<p>Prior to doing this with actual data I want to set up a simulation so I can figure out some of the methods using a simplified scenario. In particular I am interested in comparing how noise in the dataset due to the variability in individuals home range sizes and susceptibility to infection affect my ability to associate cumulative exposure risk to infection probability. For my purposes here susceptibility encompasses variability in behavior of individuals that influence pathogen exposure, immunological function, genetics, etc <span class="citation" data-cites="sweeny2022">(<a href="#ref-sweeny2022" role="doc-biblioref">Sweeny and Albery 2022</a>)</span>.</p>
</section>
<section id="risk-map" class="level1">
<h1>Risk Map</h1>
<p>I am using the elevation raster of Zion National Park included in the <code>spDataLarge</code> package as the landscape risk map. The thought behind using this and not simply a simulated raster is to have highly variable patterns and spatial autocorrelation. However to use this, I need the values to fall between 0 and 1. This is what the original maps looks like with the scaled values.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="do">## load the data from the spDataLarge package</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>riskmap <span class="ot">&lt;-</span> <span class="fu">rast</span>(<span class="fu">system.file</span>(<span class="st">"raster/srtm.tif"</span>, <span class="at">package =</span> <span class="st">"spDataLarge"</span>))</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="do">## project in utm so easier units for making the simulated tracks</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>riskmap <span class="ot">&lt;-</span> <span class="fu">project</span>(riskmap, <span class="st">"EPSG:26912"</span>)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="do">## make values [0,1]</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>riskmap <span class="ot">&lt;-</span> riskmap<span class="sc">/</span><span class="fu">max</span>(<span class="fu">values</span>(riskmap), <span class="at">na.rm=</span>T)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="do">## most places should be pretty low</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="do">## look at the 'original values'</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>  stars<span class="sc">::</span><span class="fu">geom_stars</span>(<span class="at">data =</span> stars<span class="sc">::</span><span class="fu">st_as_stars</span>(riskmap)) <span class="sc">+</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>() <span class="sc">+</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_fixed</span>() <span class="sc">+</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="cn">NULL</span>, <span class="at">y=</span><span class="cn">NULL</span>, <span class="at">fill =</span> <span class="st">"elevation scaled [0,1]"</span>, <span class="at">title =</span> <span class="st">"Origional Elevation Map"</span>) <span class="sc">+</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text =</span> <span class="fu">element_blank</span>()) <span class="co"># since don't care about location</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>I want the values to be right skewed so that most places are low risk. So I transformed the values to values<sup>3</sup> in my scaled raster to get the desired distribution of risk (pathogen density) in my risk map.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="do">## histogram of value distribution</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">values</span>(riskmap) <span class="sc">%&gt;%</span> </span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.finite</span>(srtm)) <span class="sc">%&gt;%</span> </span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">x=</span>srtm)) <span class="sc">+</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"cell values"</span>, <span class="at">y =</span> <span class="st">"frequency"</span>, <span class="at">title =</span> <span class="st">"Origional risk map values [0,1]"</span>)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="do">## add right skew to values so most are low</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>riskmap <span class="ot">&lt;-</span> riskmap<span class="sc">^</span><span class="dv">3</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="do">## plots to commpare old and new value distributions</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">values</span>(riskmap) <span class="sc">%&gt;%</span> </span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">x=</span>srtm)) <span class="sc">+</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"cell values"</span>, <span class="at">y =</span> <span class="st">"frequency"</span>, <span class="at">title =</span> <span class="st">"Skewed risk map values [0,1]"</span>)</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a><span class="do">## plot old and new next to each other</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>p1<span class="sc">+</span>p2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>To make things run quickly, I aggregated the risk map so the resolution is lower. Then cropped the map to a squarer area so individuals don’t fall outside of the area with values (the grey parts of the map above).</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="do">## make resolution lower so things run quickly</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>riskmap <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(riskmap, <span class="at">fact=</span><span class="dv">5</span>, <span class="at">fun=</span><span class="st">"mean"</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="do">## make square</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>tmp <span class="ot">&lt;-</span> <span class="fu">vect</span>(<span class="fu">ext</span>(riskmap)<span class="sc">-</span><span class="dv">1500</span>, <span class="at">crs=</span><span class="fu">crs</span>(riskmap))</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>riskmap <span class="ot">&lt;-</span> <span class="fu">crop</span>(riskmap, tmp)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="do">## plot the new lower resolution map</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>  stars<span class="sc">::</span><span class="fu">geom_stars</span>(<span class="at">data =</span> stars<span class="sc">::</span><span class="fu">st_as_stars</span>(riskmap)) <span class="sc">+</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">option =</span> <span class="st">"H"</span>) <span class="sc">+</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_fixed</span>() <span class="sc">+</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="cn">NULL</span>, <span class="at">y=</span><span class="cn">NULL</span>, <span class="at">fill =</span> <span class="st">"risk level"</span>, <span class="at">title =</span> <span class="st">"Risk Map"</span>) <span class="sc">+</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text =</span> <span class="fu">element_blank</span>()) <span class="co"># since don't care about location</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="do">## check the data structure</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="co"># riskmap</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="single-simulation" class="level1">
<h1>Single simulation</h1>
<p>I am using a single simulation to figure out how to set up the simulation and to outline the process involved in the simulation. Once that is ironed out, I’ll put everything into a single function so I can repeat the simulation many times and get confidence intervals for my estimated effects.</p>
<section id="simulate-movement" class="level2">
<h2 class="anchored" data-anchor-id="simulate-movement">Simulate movement</h2>
<p>To simulate movement of individuals I followed the <a href="https://cran.r-project.org/web/packages/SiMRiv/vignettes/SiMRiv.pdf"><code>SiMRiv</code> vignette</a>. I wanted to have two types of movement to use in my simulation. I am calling these:</p>
<ul>
<li><strong>Simple random walk</strong> - Single-state uncorrelated movement in an homogeneous landscape using Brownian motion <span class="citation" data-cites="turchin1998">(<a href="#ref-turchin1998" role="doc-biblioref">Turchin 1998</a>)</span> to make individuals ‘vibrate’ in place. Movement of only this type is the ‘null’ state because an individual essentially staying in one place will have an exposure risk equal to their singular location. This state will be used to demonstrate that an individual’s probability of infection is proportional to their exposures.<br>
</li>
<li><strong>Complex correlated walk</strong> - Multistate correlated movement in a heterogeneous landscape using Levy walk-like movement with two-state movements composed of small random walks and bursts of longer correlated random walks <span class="citation" data-cites="reynolds2010">(<a href="#ref-reynolds2010" role="doc-biblioref">Reynolds 2010</a>)</span>. A heterogeneous landscape is used to makes some areas high resistance, thus the population’s movements will look more similar, since most movement will follow low resistance ‘paths’ (roads), but individuals will still randomly branch off into higher resistance areas.</li>
</ul>
<p>An important part of simulating movement is the step length, which need to be relevant to the animal and the resolution of the raster. To limit movement in the simple random walk, make step sizes 1/20th of the resolution of the risk map. Find the resolution of the risk map. The resolution show help with choosing a step length that is relative to the pixel sizes so that individuals can move, but not too much within a given step. Steps of ~1/10 a pixel seem reasonable.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="do">## save cell size</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>cell_size <span class="ot">=</span> <span class="fu">res</span>(riskmap)[<span class="dv">1</span>]</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="do">## number of steps</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>nsteps <span class="ot">=</span> <span class="dv">1000</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="do">## random walk with step lengths relative to rast resolution</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>rand.walk <span class="ot">&lt;-</span> <span class="fu">state</span>(<span class="at">concentration =</span> <span class="dv">0</span>, <span class="co">#turning angle concentration; 0=random</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>                             <span class="at">pwind =</span> <span class="fu">perceptualRange</span>(<span class="st">"gaussian"</span>, <span class="co"># centered on indiv's position</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>                                                     cell_size<span class="sc">/</span><span class="dv">5</span>), <span class="do">## radius of perceptual range 1/4 of steplength</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>                             <span class="at">steplen =</span> cell_size<span class="sc">/</span><span class="dv">20</span>, <span class="co">#maximum step length</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>                             <span class="at">name =</span> <span class="st">"tight_random"</span>) <span class="co">#name of the state</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a><span class="do">## correlated walk with step lengths relative to rast resolutions</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>corr.walk <span class="ot">&lt;-</span> <span class="fu">state</span>(<span class="at">concentration =</span> <span class="fl">0.9</span>, <span class="co">#turning angle concentration; 1=straight line</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>                             <span class="at">pwind =</span> <span class="fu">perceptualRange</span>(<span class="st">"circular"</span>, <span class="co"># gives equal weight to all pixels centered on current position</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>                                                     cell_size<span class="sc">*</span><span class="dv">2</span>), <span class="do">## radius of perceptual range 1/4 of steplength</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>                             <span class="at">steplen =</span> cell_size<span class="sc">/</span><span class="dv">5</span>, <span class="co">#maximum step length</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>                             <span class="at">name =</span> <span class="st">"correlated"</span>) <span class="co">#name of the state</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a><span class="do">## using those states make walkers</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>rand.walker <span class="ot">&lt;-</span> <span class="fu">species</span>(<span class="at">states =</span> rand.walk)</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a><span class="do">## set up levy walker walk</span></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>levy.walker <span class="ot">&lt;-</span> <span class="fu">species</span>(<span class="at">states =</span> <span class="fu">c</span>(rand.walk,</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>                                  corr.walk),</span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>                       <span class="at">trans =</span> <span class="fu">transitionMatrix</span>(<span class="fl">0.05</span>, <span class="fl">0.01</span>)) <span class="co">#probabilities of changing state 1 -&gt; 2 and 2 -&gt; 1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="simple-random-walk" class="level3">
<h3 class="anchored" data-anchor-id="simple-random-walk">Simple random walk</h3>
<p>I simulated the simple random walks for 100 individuals all starting at randomly selected areas with in an area of interest (aoi). Because individuals can run off the edge of the raster, the starting locations should not be near the edge. The area of interest is the white rectangle, with each point representing an individual’s starting location.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="do">## generate random starting points </span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="do">### avoid edges by defining area of interest more inside the risk map</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="do">### find bounding box of risk map</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>aoi <span class="ot">&lt;-</span> <span class="fu">st_bbox</span>(riskmap)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="do">### make insto sfc (spatial) object</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>aoi <span class="ot">&lt;-</span> <span class="fu">st_as_sfc</span>(aoi)</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="do">### buffer to be 5 cells from edge of riskmap</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>aoi <span class="ot">&lt;-</span> <span class="fu">st_buffer</span>(aoi, <span class="sc">-</span>cell_size<span class="sc">*</span><span class="dv">5</span>)</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="co"># aoi &lt;- crop(riskmap, aoi)</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="co"># ggplot() +</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="co">#   stars::geom_stars(data = stars::st_as_stars(riskmap)) +</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_fill_viridis_c(option = "H") +</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="co">#   coord_fixed() +</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="co">#   labs(x=NULL, y=NULL, fill = "risk level", title = "Area of interest for starting locations on Risk Map") +</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme(axis.text = element_blank()) +# since don't care about location</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_sf(data = aoi, fill = "white", alpha = 0.3, color = "white", lwd = 1)</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>start_coord <span class="ot">&lt;-</span> <span class="fu">st_sample</span>(aoi, <span class="dv">100</span>, <span class="at">type =</span> <span class="st">"random"</span>)</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a><span class="do">## plot it</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>  stars<span class="sc">::</span><span class="fu">geom_stars</span>(<span class="at">data =</span> stars<span class="sc">::</span><span class="fu">st_as_stars</span>(riskmap)) <span class="sc">+</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">option =</span> <span class="st">"H"</span>) <span class="sc">+</span></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_fixed</span>() <span class="sc">+</span></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="cn">NULL</span>, <span class="at">y=</span><span class="cn">NULL</span>, <span class="at">fill =</span> <span class="st">"risk level"</span>, <span class="at">title =</span> <span class="st">"Random walk starting locations"</span>) <span class="sc">+</span></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span><span class="co"># since don't care about location</span></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> aoi, <span class="at">fill =</span> <span class="st">"white"</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>, <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">lwd =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> start_coord)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The random walks for all the individuals look like my intended “vibrating in place” outcome, such that individuals will spend all their time in just a few pixels, so theoretically their exposure risk is less variable.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="do">## need the locations as a nx2 matrix</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="co"># start_coord_mat &lt;- as.matrix(as.data.frame(start_coord, geom="xy"))</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>start_coord_mat <span class="ot">&lt;-</span> <span class="fu">st_coordinates</span>(start_coord)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="do">## simulate single state walks of 1000 steps</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>sim.rw <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>) {</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>  <span class="do">## simulate from location i</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>  tmp <span class="ot">&lt;-</span> <span class="fu">simulate</span>(rand.walker, nsteps,</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>                   <span class="at">coords =</span> start_coord_mat[i,])</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>  <span class="do">## save results to a list</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>  sim.rw[[i]] <span class="ot">&lt;-</span> <span class="fu">cbind</span>(tmp[,<span class="dv">1</span>], tmp[,<span class="dv">2</span>])</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a><span class="do">## make in to sfc lines</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>sim.rw.sfc <span class="ot">&lt;-</span> <span class="fu">lapply</span>(sim.rw, st_linestring)</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>sim.rw.sfc <span class="ot">&lt;-</span> <span class="fu">st_sf</span>(<span class="at">id =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>, <span class="at">geometry =</span> sim.rw.sfc) <span class="sc">%&gt;%</span> </span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_set_crs</span>(<span class="fu">st_crs</span>(riskmap))</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a><span class="do">## plot it</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>  stars<span class="sc">::</span><span class="fu">geom_stars</span>(<span class="at">data =</span> stars<span class="sc">::</span><span class="fu">st_as_stars</span>(riskmap)) <span class="sc">+</span></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">option =</span> <span class="st">"H"</span>) <span class="sc">+</span></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_fixed</span>() <span class="sc">+</span></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="cn">NULL</span>, <span class="at">y=</span><span class="cn">NULL</span>, <span class="at">fill =</span> <span class="st">"risk level"</span>, <span class="at">title =</span> <span class="st">"Random walks"</span>) <span class="sc">+</span></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span><span class="co"># since don't care about location</span></span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> sim.rw.sfc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="correlated-walks" class="level3">
<h3 class="anchored" data-anchor-id="correlated-walks">Correlated walks</h3>
<p>A resistance raster is needed to get correlated (levy walker) walks that are similar between individuals.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="do">## basemaps for resistance --NOT using because individual end up in a hairball</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="co"># landcover &lt;- resistanceFromShape(</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="co"># system.file("doc/landcover.shp", package="SiMRiv")</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co"># , res = 50, field = "coverclass", mapvalues = c(</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="co"># "forest" = 0.5, "urban" = 1, "dam" = 0</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="co"># , "shrubland" = 0.75), background = 0.95)</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="co">#  </span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="do">## river shape is the main resistance, because walks will follow paths</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>river.shape <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_read</span>(<span class="fu">system.file</span>(<span class="st">"doc/river-sample.shp"</span>, <span class="at">package=</span><span class="st">"SiMRiv"</span>), <span class="at">quiet =</span> T)</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="do">## resistence surface</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>resistance <span class="ot">&lt;-</span> <span class="fu">resistanceFromShape</span>(river.shape, <span class="co">#system.file("doc/river-sample.shp", package="SiMRiv"),</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>                                       <span class="co"># baseRaster = landcover, ## not using</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">res =</span><span class="dv">50</span>, <span class="co">#provide when don't provide basemap</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">buffer =</span> <span class="dv">300</span>, <span class="at">field =</span> <span class="fl">0.01</span>,</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">background =</span> <span class="fl">0.75</span>, <span class="at">margin =</span> <span class="dv">3000</span>)</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a><span class="do">## add central area with low resistence so individuals start in roughly the same place</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>river.cent <span class="ot">&lt;-</span> <span class="fu">st_buffer</span>(<span class="fu">st_centroid</span>(<span class="fu">st_union</span>(river.shape)), <span class="dv">200</span>)</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>resistance <span class="ot">&lt;-</span> <span class="fu">resistanceFromShape</span>(river.cent, </span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">baseRaster =</span> resistance, </span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">buffer =</span> <span class="dv">1000</span>, <span class="at">field =</span> <span class="dv">0</span>, </span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">background =</span> <span class="dv">1</span>, <span class="at">margin =</span> <span class="dv">3000</span>)</span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a><span class="co"># buffer here is just some magical function to convert river</span></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a><span class="co"># order into a meaningful value in the [0, 1] range!</span></span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a><span class="co"># plot(resistance, axes = F, main="resistence raster")</span></span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a><span class="co"># resistance</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Then the resistance raster should be down sampled and moved to the same location as the risk map.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="do">## move the resistence 'rivers' to the same location as the risk map</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>resistance <span class="ot">&lt;-</span> <span class="fu">rast</span>(<span class="at">nrows =</span> <span class="fu">dim</span>(resistance)[<span class="dv">1</span>],</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">ncols =</span> <span class="fu">dim</span>(resistance)[<span class="dv">2</span>],</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">nlyrs =</span> <span class="dv">1</span>, </span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">names =</span> <span class="st">"resistance"</span>, </span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>                   <span class="at">extent =</span> <span class="fu">st_bbox</span>(aoi),</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>                   <span class="at">vals =</span> <span class="fu">values</span>(resistance),</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>                   <span class="at">crs =</span> <span class="fu">crs</span>(riskmap))</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="do">## resample to resolution matches riskmap</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>resistance <span class="ot">&lt;-</span> <span class="fu">resample</span>(resistance, riskmap, <span class="at">method =</span> <span class="st">"rms"</span>)</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a><span class="do">## make NAs to 1</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>resistance[<span class="fu">is.na</span>(resistance)] <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a><span class="do">## plot it</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>  stars<span class="sc">::</span><span class="fu">geom_stars</span>(<span class="at">data =</span> stars<span class="sc">::</span><span class="fu">st_as_stars</span>(resistance)) <span class="sc">+</span></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_steps</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.001</span>, <span class="fl">0.4</span>, <span class="fl">0.6</span>, <span class="fl">0.75</span>, <span class="dv">1</span>),</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>                   <span class="at">low=</span><span class="st">"white"</span>, <span class="at">high =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># scale_fill_viridis_c(option = "H") +</span></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_fixed</span>() <span class="sc">+</span></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="cn">NULL</span>, <span class="at">y=</span><span class="cn">NULL</span>, <span class="at">fill =</span> <span class="st">"resistance"</span>, <span class="at">title =</span> <span class="st">"Resistance layer"</span>) <span class="sc">+</span></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text =</span> <span class="fu">element_blank</span>()) <span class="co"># since don't care about location</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>At first I tried using the same random starting locations as above to generate my correlated walks for each individual.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="do">## simulate single state walks of 1000 steps</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>sim.rw <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>) {</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="do">## simulate from location i</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  tmp <span class="ot">&lt;-</span> <span class="fu">simulate</span>(levy.walker, nsteps,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>                  <span class="at">resist =</span> <span class="fu">raster</span>(resistance),</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>                   <span class="at">coords =</span> start_coord_mat[i,])</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  <span class="do">## save results to a list</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>  sim.rw[[i]] <span class="ot">&lt;-</span> <span class="fu">cbind</span>(tmp[,<span class="dv">1</span>], tmp[,<span class="dv">2</span>])</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a><span class="do">## make in to sfc lines</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>sim.rw.bad <span class="ot">&lt;-</span> <span class="fu">lapply</span>(sim.rw, st_linestring)</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>sim.rw.bad <span class="ot">&lt;-</span> <span class="fu">st_sf</span>(<span class="at">id =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>, <span class="at">geometry =</span> sim.rw.bad) <span class="sc">%&gt;%</span> </span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_set_crs</span>(<span class="fu">st_crs</span>(riskmap))</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a><span class="do">## plot it</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>  stars<span class="sc">::</span><span class="fu">geom_stars</span>(<span class="at">data =</span> stars<span class="sc">::</span><span class="fu">st_as_stars</span>(resistance)) <span class="sc">+</span></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_steps</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.001</span>, <span class="fl">0.4</span>, <span class="fl">0.6</span>, <span class="fl">0.75</span>, <span class="dv">1</span>),</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>                   <span class="at">low=</span><span class="st">"white"</span>, <span class="at">high =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># scale_fill_viridis_c(option = "H") +</span></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_fixed</span>() <span class="sc">+</span></span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="cn">NULL</span>, <span class="at">y=</span><span class="cn">NULL</span>, <span class="at">fill =</span> <span class="st">"resistance"</span>, <span class="at">title =</span> <span class="st">"Levy-walker walks - random start locations"</span>) <span class="sc">+</span></span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span><span class="co"># since don't care about location</span></span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> sim.rw.bad, <span class="at">col=</span><span class="st">"red"</span>, <span class="at">alpha=</span><span class="fl">0.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>However, to make this more realistic, my correlated walks should also act like individuals following paths then delving off into different areas such as people accessing their crop fields. So instead of using random starting locations, I made the starting locations only be in low resistance areas.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="do">## new starting coords in areas of low resistance so don't get stuck</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>init <span class="ot">=</span> <span class="fu">xyFromCell</span>(resistance, <span class="fu">sample</span>(<span class="fu">which</span>(<span class="fu">values</span>(resistance) <span class="sc">==</span> <span class="dv">0</span>), <span class="dv">100</span>, <span class="at">replace=</span>T))</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="do">## simulate</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>sim.rw <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>) {</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  <span class="do">## simulate from location i</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>  tmp <span class="ot">&lt;-</span> <span class="fu">simulate</span>(levy.walker, nsteps,</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>                  <span class="at">resist =</span> <span class="fu">raster</span>(resistance),</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>                   <span class="at">coords =</span> init[i,])</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>  <span class="do">## save results to a list</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>  sim.rw[[i]] <span class="ot">&lt;-</span> <span class="fu">cbind</span>(tmp[,<span class="dv">1</span>], tmp[,<span class="dv">2</span>])</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a><span class="do">## make in to sfc lines</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>sim.rw.levy <span class="ot">&lt;-</span> <span class="fu">lapply</span>(sim.rw, st_linestring)</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>sim.rw.levy <span class="ot">&lt;-</span> <span class="fu">st_sf</span>(<span class="at">id =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>, <span class="at">geometry =</span> sim.rw.levy) <span class="sc">%&gt;%</span> </span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_set_crs</span>(<span class="fu">st_crs</span>(riskmap))</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a><span class="do">## plot it</span></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>  stars<span class="sc">::</span><span class="fu">geom_stars</span>(<span class="at">data =</span> stars<span class="sc">::</span><span class="fu">st_as_stars</span>(resistance)) <span class="sc">+</span></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_steps</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.001</span>, <span class="fl">0.4</span>, <span class="fl">0.6</span>, <span class="fl">0.75</span>, <span class="dv">1</span>),</span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>                   <span class="at">low=</span><span class="st">"white"</span>, <span class="at">high =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># scale_fill_viridis_c(option = "H") +</span></span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_fixed</span>() <span class="sc">+</span></span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="cn">NULL</span>, <span class="at">y=</span><span class="cn">NULL</span>, <span class="at">fill =</span> <span class="st">"resistance"</span>, <span class="at">title =</span> <span class="st">"Levy-walker walks"</span>) <span class="sc">+</span></span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span><span class="co"># since don't care about location</span></span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> sim.rw.levy, <span class="at">col=</span><span class="st">"red"</span>, <span class="at">alpha=</span><span class="fl">0.25</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="exposure-risk" class="level2">
<h2 class="anchored" data-anchor-id="exposure-risk">Exposure risk</h2>
<p>For each individual I calculate their utilization distribution based purely on the proportion of points in each cell (density). For real movement data using more accurate estimates of utilization distributions such as kernel density, Brownian bridge movement models, etc. However, those methods are slow.</p>
<p>To figure out how to do this, I first tried it out with just one individual.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="do">## which individual (1-100)</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>who <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="do">## kernel density estimate</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>kde.trial <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rasterize</span>(<span class="fu">st_cast</span>(sim.rw.levy[who,], <span class="st">"MULTIPOINT"</span>), riskmap, <span class="at">fun =</span> <span class="st">"length"</span>, <span class="at">background =</span> <span class="dv">0</span>)<span class="sc">/</span>nsteps</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">sum</span>(<span class="fu">values</span>(kde.trial), <span class="at">na.rm=</span>T) <span class="sc">!=</span> <span class="dv">1</span>){</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stop</span>(<span class="st">"the sum of the density should be equal to 1"</span>)</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>To see what that looks like, for the single individual I cropped to just the immediate area that individual used the plot their density estimate.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="do">## crop to area where the individual was so not tiny</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>kde.sm <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">crop</span>(kde.trial, <span class="fu">st_buffer</span>(sim.rw.levy[who,], <span class="dv">2000</span>))</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="do">## similarly crop riskmap to same area</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>risk.sm <span class="ot">&lt;-</span> <span class="fu">crop</span>(riskmap, <span class="fu">st_buffer</span>(sim.rw.levy[who,], <span class="dv">2000</span>))</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="do">## plot traj and kde</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>  stars<span class="sc">::</span><span class="fu">geom_stars</span>(<span class="at">data =</span> stars<span class="sc">::</span><span class="fu">st_as_stars</span>(kde.sm)) <span class="sc">+</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">option=</span><span class="st">"A"</span>, <span class="at">direction =</span> <span class="sc">-</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_fixed</span>() <span class="sc">+</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="cn">NULL</span>, <span class="at">y=</span><span class="cn">NULL</span>, <span class="at">fill =</span> <span class="st">"kde"</span>, <span class="at">title =</span> <span class="st">"Density raster of one individual"</span>) <span class="sc">+</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span><span class="co"># since don't care about location</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> sim.rw.levy[who,])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Now I want to calculate the exposure risk for each individual <span class="math inline">\(k\)</span> in each pixel (<span class="math inline">\(i\)</span>) as a function of the time they spend in that pixel and the risk of exposure in that pixel.</p>
<p><span class="math display">\[
Exposure_{ki} = kde_i*risk_i
\]</span></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="do">## calculate risk </span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>kde.risk <span class="ot">&lt;-</span> kde.sm<span class="sc">*</span>risk.sm</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="do">## plots to demo</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  tidyterra<span class="sc">::</span><span class="fu">geom_spatraster</span>(<span class="at">data=</span>risk.sm) <span class="sc">+</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">option=</span><span class="st">"A"</span>, <span class="at">direction =</span> <span class="sc">-</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Landscape risk"</span>, <span class="at">fill =</span> <span class="st">"risk"</span>) <span class="sc">+</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>, <span class="at">axis.text =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.direction =</span> <span class="st">"horizontal"</span>)</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>  tidyterra<span class="sc">::</span><span class="fu">geom_spatraster</span>(<span class="at">data=</span>kde.sm) <span class="sc">+</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">option=</span><span class="st">"A"</span>, <span class="at">direction =</span> <span class="sc">-</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"KDE of Individual use"</span>, <span class="at">fill =</span> <span class="st">"use"</span>) <span class="sc">+</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>, <span class="at">axis.text =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.direction =</span> <span class="st">"horizontal"</span>)</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>  tidyterra<span class="sc">::</span><span class="fu">geom_spatraster</span>(<span class="at">data=</span>kde.risk) <span class="sc">+</span></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">option=</span><span class="st">"A"</span>, <span class="at">direction =</span> <span class="sc">-</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Infection probability"</span>, <span class="at">fill =</span> <span class="st">"probability"</span>) <span class="sc">+</span></span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>, <span class="at">axis.text =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.direction =</span> <span class="st">"horizontal"</span>)</span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2 <span class="sc">+</span> p3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Therefore for each individual <span class="math inline">\(k\)</span> their cumulative ‘exposure risk’ the sum of all their exposures in pixels, where <span class="math inline">\(i\)</span> is <span class="math inline">\(1:n_{pixels}\)</span>: <span class="math display">\[
Exposure_k = \sum{kde_i*risk_i}
\]</span></p>
<p>To calculate the cummulative exposure risk for all individuals, I used a function.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="do">## make a function</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>measure_risk <span class="ot">&lt;-</span> <span class="cf">function</span>(walker, riskmap, nsteps){</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="do">## convert from lines to points</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  pts <span class="ot">&lt;-</span> <span class="fu">st_cast</span>(walker, <span class="st">"MULTIPOINT"</span>)</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>  <span class="do">## dataframe with any attributes (just IDs)</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> pts <span class="sc">%&gt;%</span> <span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span> <span class="fu">as.data.frame</span>()</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>  pts <span class="ot">&lt;-</span> <span class="fu">vect</span>(pts)</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>  <span class="do">## for each individual rasterize their points so have sum of points in each pixel</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>  <span class="do">## this is not working using the stars::st_rasterize, or the terra::rasterize -- both return one object of all individuals, not an obj per indiv</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>  <span class="do">## also tried using apply, lapp, and app with those terra::rasterize</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>  kde <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(pts)){</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>    kde[[i]] <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rasterize</span>(pts[i,], riskmap, <span class="at">fun =</span> <span class="st">"length"</span>, <span class="at">background =</span> <span class="dv">0</span>)<span class="sc">/</span>nsteps</span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>  <span class="do">## multiply time in cell (kde) * cell's risk</span></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>  kde.risk <span class="ot">&lt;-</span> <span class="fu">lapply</span>(kde, <span class="cf">function</span>(i) i<span class="sc">*</span>riskmap)</span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>  <span class="do">## sum of values in each layer are individual's risk</span></span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a>  indiv.risk <span class="ot">&lt;-</span> <span class="fu">lapply</span>(kde.risk, <span class="cf">function</span>(i) <span class="fu">sum</span>(<span class="fu">values</span>(i), <span class="at">na.rm=</span>T))</span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a>  df<span class="sc">$</span>exp_risk <span class="ot">&lt;-</span> <span class="fu">unlist</span>(indiv.risk)</span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(df)</span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>I found the cummulative expsoure risk for each individual using the function.</p>
<p>The distribution of values in the random walkers is the range of the map, which is expected.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="do">## look at some of the values</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="co"># indiv.risk.rw %&gt;% head() %&gt;% knitr::kable(title = "Cummulative exposure risk (`exp_risk`) by individual (`id`)")</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>indiv.risk.rw <span class="sc">%&gt;%</span> </span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">x =</span> exp_risk)) <span class="sc">+</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"risk"</span>, <span class="at">title =</span> <span class="st">"Distribution of individual's cumulative exposure risk - Random walks"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The distribution of values in the correlated walkers is less then the range of the map, which is also expected.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># indiv.risk.levy %&gt;% head()</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>indiv.risk.levy <span class="sc">%&gt;%</span> </span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">x =</span> exp_risk)) <span class="sc">+</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"risk"</span>, <span class="at">title =</span> <span class="st">"Distribution of individual's cumulative exposure risk - Levy-walker walks"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="assisgn-susceptibility" class="level2">
<h2 class="anchored" data-anchor-id="assisgn-susceptibility">Assisgn susceptibility</h2>
<p>Individuals should have variable susceptibility so that not everyone’s probability of infection equals their risk sum. This is adding noise to the data. I want to compare the randomly assign susceptibility to a fixed susceptibility for each simulation. The fixed susceptibility is just the average susceptibility of all individuals in that round of the simulation. For this simulation I am assigning susceptibility randomly using a uniform distribution between 0.7 and 0.9. and the fixed susceptibility with the average of the random susceptibility values.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="do">## susceptibility is variable between individuals</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>susceptibility <span class="ot">=</span> <span class="fu">runif</span>(<span class="dv">100</span>, <span class="fl">0.7</span>, <span class="fl">0.9</span>)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>mean_suscept <span class="ot">=</span> <span class="fu">mean</span>(susceptibility)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The probability of infection is a product of the individuals exposure risk and susceptibility.</p>
<div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="do">## make a dataframe for the outcomes --- random walkers</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>rw_risk <span class="ot">&lt;-</span> <span class="fu">cbind</span>(indiv.risk.rw,</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">data.frame</span>( <span class="at">susceptibility =</span> susceptibility)) <span class="sc">%&gt;%</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>  <span class="do">## predict infections based on exposure risk</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">infected_es =</span> <span class="fu">rbinom</span>(<span class="dv">1</span>, <span class="dv">1</span>, exp_risk <span class="sc">*</span> susceptibility ), <span class="co"># sum(exp_risk * susceptibility)</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>           <span class="at">infected_e =</span> <span class="fu">rbinom</span>(<span class="dv">1</span>, <span class="dv">1</span>, exp_risk <span class="sc">*</span> mean_suscept)) <span class="co"># sum(exposure risk) alone</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="do">## see how many people infected  = 1</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>rw_risk <span class="sc">%&gt;%</span> <span class="fu">count</span>(infected_es) <span class="sc">%&gt;%</span> knitr<span class="sc">::</span><span class="fu">kable</span>()</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>rw_risk <span class="sc">%&gt;%</span> <span class="fu">count</span>(infected_e) <span class="sc">%&gt;%</span> knitr<span class="sc">::</span><span class="fu">kable</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="tbl-anonymous-3622400" class="cell tbl-parent quarto-layout-panel anchored">
<div class="panel-caption table-caption">
<p>Infections in Random Walkers</p>
</div>
<div class="quarto-layout-row quarto-layout-valign-top">
<div id="tbl-anonymous-3622400-1" class="quarto-layout-cell quarto-layout-cell-subref anchored" data-ref-parent="tbl-anonymous-3622400" style="flex-basis: 50.0%;justify-content: center;">
<table class="table table-sm table-striped small">
<caption>exposure*susceptibility</caption>
<thead>
<tr class="header">
<th style="text-align: right;">infected_es</th>
<th style="text-align: right;">n</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">0</td>
<td style="text-align: right;">73</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">27</td>
</tr>
</tbody>
</table>
</div>
<div id="tbl-anonymous-3622400-2" class="quarto-layout-cell quarto-layout-cell-subref anchored" data-ref-parent="tbl-anonymous-3622400" style="flex-basis: 50.0%;justify-content: center;">
<table class="table table-sm table-striped small">
<caption>exposure*avg susceptbility</caption>
<thead>
<tr class="header">
<th style="text-align: right;">infected_e</th>
<th style="text-align: right;">n</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">0</td>
<td style="text-align: right;">74</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">26</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="do">## make a dataframe for the outcomes --- levy walkers</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>levy_risk <span class="ot">&lt;-</span> <span class="fu">cbind</span>(indiv.risk.levy,</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">data.frame</span>( <span class="at">susceptibility =</span> susceptibility)) <span class="sc">%&gt;%</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>  <span class="do">## predict infections based on exposure risk</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">infected_es =</span> <span class="fu">rbinom</span>(<span class="dv">1</span>, <span class="dv">1</span>, exp_risk <span class="sc">*</span> susceptibility ), <span class="co"># sum(exp_risk * susceptibility)</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>           <span class="at">infected_e =</span> <span class="fu">rbinom</span>(<span class="dv">1</span>, <span class="dv">1</span>, exp_risk <span class="sc">*</span> mean_suscept)) <span class="co"># sum(exposure risk) alone</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a><span class="do">## see how many people infected  = 1</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>levy_risk <span class="sc">%&gt;%</span> <span class="fu">count</span>(infected_es) <span class="sc">%&gt;%</span> knitr<span class="sc">::</span><span class="fu">kable</span>()</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>levy_risk <span class="sc">%&gt;%</span> <span class="fu">count</span>(infected_e) <span class="sc">%&gt;%</span> knitr<span class="sc">::</span><span class="fu">kable</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="tbl-anonymous-114101" class="cell tbl-parent quarto-layout-panel anchored">
<div class="panel-caption table-caption">
<p>Infections in Correlated Walkers</p>
</div>
<div class="quarto-layout-row quarto-layout-valign-top">
<div id="tbl-anonymous-114101-1" class="quarto-layout-cell quarto-layout-cell-subref anchored" data-ref-parent="tbl-anonymous-114101" style="flex-basis: 50.0%;justify-content: center;">
<table class="table table-sm table-striped small">
<caption>exposure*susceptibility</caption>
<thead>
<tr class="header">
<th style="text-align: right;">infected_es</th>
<th style="text-align: right;">n</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">0</td>
<td style="text-align: right;">65</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">35</td>
</tr>
</tbody>
</table>
</div>
<div id="tbl-anonymous-114101-2" class="quarto-layout-cell quarto-layout-cell-subref anchored" data-ref-parent="tbl-anonymous-114101" style="flex-basis: 50.0%;justify-content: center;">
<table class="table table-sm table-striped small">
<caption>exposure*avg susceptbility</caption>
<thead>
<tr class="header">
<th style="text-align: right;">infected_e</th>
<th style="text-align: right;">n</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">0</td>
<td style="text-align: right;">65</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">35</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</section>
<section id="results" class="level2">
<h2 class="anchored" data-anchor-id="results">Results</h2>
<p>If the map worked, then exposure risk should predict infection in the random walkers.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(rw_risk, <span class="fu">aes</span>(<span class="at">x=</span>exp_risk, <span class="at">y =</span> infected_es))<span class="sc">+</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">col=</span><span class="fu">factor</span>(infected_es))) <span class="sc">+</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">"lm"</span>) <span class="sc">+</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"exposure risk"</span>, <span class="at">y =</span> <span class="st">"infected"</span>, <span class="at">col =</span> <span class="st">"infected"</span>, <span class="at">subtitle =</span> <span class="st">"exposure * susceptbility"</span>)</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(rw_risk, <span class="fu">aes</span>(<span class="at">x=</span>exp_risk, <span class="at">y =</span> infected_e))<span class="sc">+</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">col=</span><span class="fu">factor</span>(infected_e))) <span class="sc">+</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">"lm"</span>) <span class="sc">+</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"exposure risk"</span>, <span class="at">y =</span> <span class="st">"infected"</span>, <span class="at">col =</span> <span class="st">"infected"</span>, <span class="at">subtitle =</span> <span class="st">"exposure *  avg susceptbility"</span>)</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2 <span class="sc">+</span> <span class="fu">plot_layout</span>(<span class="at">guides =</span> <span class="st">"collect"</span>) <span class="sc">+</span> <span class="fu">plot_annotation</span>(<span class="at">title =</span> <span class="st">"Random walker infections"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-30-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Not great, but the infected individuals do have higher exposure risks. Let’s see how it worked for the Levy-walker correlated walkers that covered much more ground.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(levy_risk, <span class="fu">aes</span>(<span class="at">x=</span>exp_risk, <span class="at">y =</span> infected_es))<span class="sc">+</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">col=</span><span class="fu">factor</span>(infected_es))) <span class="sc">+</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">"lm"</span>) <span class="sc">+</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"exposure risk"</span>, <span class="at">y =</span> <span class="st">"infected"</span>, <span class="at">col =</span> <span class="st">"infected"</span>, <span class="at">subtitle =</span> <span class="st">"exposure * susceptbility"</span>)</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(levy_risk, <span class="fu">aes</span>(<span class="at">x=</span>exp_risk, <span class="at">y =</span> infected_e))<span class="sc">+</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">col=</span><span class="fu">factor</span>(infected_e))) <span class="sc">+</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">"lm"</span>) <span class="sc">+</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"exposure risk"</span>, <span class="at">y =</span> <span class="st">"infected"</span>, <span class="at">col =</span> <span class="st">"infected"</span>, <span class="at">subtitle =</span> <span class="st">"exposure *  avg susceptbility"</span>)</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2 <span class="sc">+</span> <span class="fu">plot_layout</span>(<span class="at">guides =</span> <span class="st">"collect"</span>) <span class="sc">+</span> <span class="fu">plot_annotation</span>(<span class="at">title =</span> <span class="st">"Correlated walker infections"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-31-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Compare predictive accuracy between the models</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>pred_acc_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(x, infected_type){</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  x<span class="sc">$</span>infected <span class="ot">&lt;-</span> x <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">any_of</span>(infected_type)) <span class="sc">%&gt;%</span> <span class="fu">pull</span>()</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  <span class="do">## binomial model</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>  mod <span class="ot">&lt;-</span> <span class="fu">glm</span>(infected <span class="sc">~</span> exp_risk, <span class="at">data =</span> x, <span class="at">family =</span> <span class="st">"binomial"</span>)</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>  <span class="do">## predicted prob of infection</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>  x<span class="sc">$</span>pred_prob <span class="ot">&lt;-</span> <span class="fu">predict</span>(mod, x, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>  <span class="do">## if predicted prob &gt;50 say infected</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>  x<span class="sc">$</span>pred <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">*</span>(x<span class="sc">$</span>pred_prob <span class="sc">&gt;</span> .<span class="dv">5</span>)</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>  x<span class="sc">$</span>accurate <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">*</span>x<span class="sc">$</span>infected <span class="sc">==</span> x<span class="sc">$</span>pred</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sum</span>(x<span class="sc">$</span>accurate) <span class="sc">/</span><span class="fu">nrow</span>(x)</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The accuracy of the infection predictions should be highest in the random walk individuals with fixed susceptibility (exp_risk * avg susceptibility), followed by those with random susceptibility, then correlated walkers with fixed, then random susceptibility.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">walker =</span> <span class="fu">c</span>(<span class="st">"Random"</span>, <span class="st">"Random"</span>, <span class="st">"Correlated"</span>, <span class="st">"Correlated"</span>),</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>           <span class="at">susceptibility =</span> <span class="fu">c</span>(<span class="st">"Fixed"</span>, <span class="st">"Random"</span>, <span class="st">"Fixed"</span>, <span class="st">"Random"</span>),</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">accuracy =</span> <span class="fu">c</span>(<span class="fu">pred_acc_fun</span>(rw_risk, <span class="st">"infected_e"</span>),</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">pred_acc_fun</span>(rw_risk, <span class="st">"infected_es"</span>),</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">pred_acc_fun</span>(levy_risk, <span class="st">"infected_e"</span>),</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">pred_acc_fun</span>(levy_risk, <span class="st">"infected_es"</span>)</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>                        )) <span class="sc">%&gt;%</span> </span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="at">title =</span> <span class="st">"Predictive accuracy of infection probabilities"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">walker</th>
<th style="text-align: left;">susceptibility</th>
<th style="text-align: right;">accuracy</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Random</td>
<td style="text-align: left;">Fixed</td>
<td style="text-align: right;">0.77</td>
</tr>
<tr class="even">
<td style="text-align: left;">Random</td>
<td style="text-align: left;">Random</td>
<td style="text-align: right;">0.76</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Correlated</td>
<td style="text-align: left;">Fixed</td>
<td style="text-align: right;">0.64</td>
</tr>
<tr class="even">
<td style="text-align: left;">Correlated</td>
<td style="text-align: left;">Random</td>
<td style="text-align: right;">0.65</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
</section>
<section id="large-simulation" class="level1">
<h1>Large Simulation</h1>
<p>Ultimately to see how cumulative exposure risk predicts infection in people, the simulation needs to be run many times. To do that everything from the single simulation needs to be in a single function.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>simulation_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">n_steps =</span> <span class="dv">1000</span>, <span class="at">n_individuals =</span> <span class="dv">100</span>, <span class="at">susceptibility_range =</span> <span class="fu">c</span>(<span class="fl">0.7</span>, <span class="fl">0.9</span>),</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>                           <span class="at">risk_landscape =</span> riskmap, <span class="at">study_area =</span> aoi, <span class="at">landscape_resistance =</span> resistance, </span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>                           <span class="at">random_walker =</span> rand.walker, <span class="at">correlated_walker =</span> levy.walker){</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>  <span class="do">## simulate movement</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>  <span class="do">### Random (brownian) walks</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>  <span class="do">## random starting coordinates</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>  start_coord <span class="ot">&lt;-</span> <span class="fu">st_sample</span>(study_area, <span class="dv">100</span>, <span class="at">type =</span> <span class="st">"random"</span>)</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>  start_coord <span class="ot">&lt;-</span> <span class="fu">st_coordinates</span>(start_coord)</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>  <span class="do">## simulate single state walks of 1000 steps</span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>  sim.rw <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_individuals) {</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>    <span class="do">## simulate from location i</span></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>    tmp <span class="ot">&lt;-</span> <span class="fu">simulate</span>(random_walker, n_steps,</span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>                    <span class="at">coords =</span> start_coord[i,])</span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>    <span class="do">## save results to a list</span></span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>    sim.rw[[i]] <span class="ot">&lt;-</span> <span class="fu">cbind</span>(tmp[,<span class="dv">1</span>], tmp[,<span class="dv">2</span>])</span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a>  <span class="do">## make in to sfc lines</span></span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a>  walks.random <span class="ot">&lt;-</span> <span class="fu">lapply</span>(sim.rw, st_linestring)</span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a>  walks.random <span class="ot">&lt;-</span> <span class="fu">st_sf</span>(<span class="at">id =</span> <span class="dv">1</span><span class="sc">:</span>n_individuals, <span class="at">geometry =</span> walks.random) <span class="sc">%&gt;%</span> </span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_set_crs</span>(<span class="fu">st_crs</span>(risk_landscape))</span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a>  <span class="do">### Levy-walker (correlated random)</span></span>
<span id="cb25-27"><a href="#cb25-27" aria-hidden="true" tabindex="-1"></a>  <span class="do">## new starting coords in areas of low resistance so don't get stuck</span></span>
<span id="cb25-28"><a href="#cb25-28" aria-hidden="true" tabindex="-1"></a>  init <span class="ot">=</span> <span class="fu">xyFromCell</span>(resistance, <span class="fu">sample</span>(<span class="fu">which</span>(<span class="fu">values</span>(resistance) <span class="sc">==</span> <span class="dv">0</span>), <span class="dv">100</span>, <span class="at">replace=</span>T))</span>
<span id="cb25-29"><a href="#cb25-29" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-30"><a href="#cb25-30" aria-hidden="true" tabindex="-1"></a>  <span class="do">## simulate</span></span>
<span id="cb25-31"><a href="#cb25-31" aria-hidden="true" tabindex="-1"></a>  sim.rw <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb25-32"><a href="#cb25-32" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_individuals) {</span>
<span id="cb25-33"><a href="#cb25-33" aria-hidden="true" tabindex="-1"></a>    <span class="do">## simulate from location i</span></span>
<span id="cb25-34"><a href="#cb25-34" aria-hidden="true" tabindex="-1"></a>    tmp <span class="ot">&lt;-</span> <span class="fu">simulate</span>(correlated_walker, n_steps,</span>
<span id="cb25-35"><a href="#cb25-35" aria-hidden="true" tabindex="-1"></a>                    <span class="at">resist =</span> <span class="fu">raster</span>(resistance),</span>
<span id="cb25-36"><a href="#cb25-36" aria-hidden="true" tabindex="-1"></a>                    <span class="at">coords =</span> init[i,])</span>
<span id="cb25-37"><a href="#cb25-37" aria-hidden="true" tabindex="-1"></a>    <span class="do">## save results to a list</span></span>
<span id="cb25-38"><a href="#cb25-38" aria-hidden="true" tabindex="-1"></a>    sim.rw[[i]] <span class="ot">&lt;-</span> <span class="fu">cbind</span>(tmp[,<span class="dv">1</span>], tmp[,<span class="dv">2</span>])</span>
<span id="cb25-39"><a href="#cb25-39" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb25-40"><a href="#cb25-40" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-41"><a href="#cb25-41" aria-hidden="true" tabindex="-1"></a>  <span class="do">## make in to sfc lines</span></span>
<span id="cb25-42"><a href="#cb25-42" aria-hidden="true" tabindex="-1"></a>  walks.corr <span class="ot">&lt;-</span> <span class="fu">lapply</span>(sim.rw, st_linestring)</span>
<span id="cb25-43"><a href="#cb25-43" aria-hidden="true" tabindex="-1"></a>  walks.corr <span class="ot">&lt;-</span> <span class="fu">st_sf</span>(<span class="at">id =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>, <span class="at">geometry =</span> walks.corr) <span class="sc">%&gt;%</span> </span>
<span id="cb25-44"><a href="#cb25-44" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_set_crs</span>(<span class="fu">st_crs</span>(risk_landscape))</span>
<span id="cb25-45"><a href="#cb25-45" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-46"><a href="#cb25-46" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Calculate cumulative exposure risk/individual</span></span>
<span id="cb25-47"><a href="#cb25-47" aria-hidden="true" tabindex="-1"></a>  <span class="do">### random walkers</span></span>
<span id="cb25-48"><a href="#cb25-48" aria-hidden="true" tabindex="-1"></a>  indiv.risk.random <span class="ot">&lt;-</span> <span class="fu">measure_risk</span>(<span class="at">walker =</span> walks.random, <span class="at">riskmap =</span> risk_landscape, <span class="at">nsteps =</span> n_steps)</span>
<span id="cb25-49"><a href="#cb25-49" aria-hidden="true" tabindex="-1"></a>  <span class="do">### correlated random walkers</span></span>
<span id="cb25-50"><a href="#cb25-50" aria-hidden="true" tabindex="-1"></a>  indiv.risk.corr <span class="ot">&lt;-</span> <span class="fu">measure_risk</span>(<span class="at">walker =</span> walks.corr, <span class="at">riskmap =</span> risk_landscape, <span class="at">nsteps =</span> n_steps)</span>
<span id="cb25-51"><a href="#cb25-51" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-52"><a href="#cb25-52" aria-hidden="true" tabindex="-1"></a>  <span class="do">## assign susceptibility</span></span>
<span id="cb25-53"><a href="#cb25-53" aria-hidden="true" tabindex="-1"></a>  susceptibility <span class="ot">=</span> <span class="fu">runif</span>(<span class="dv">100</span>, susceptibility_range[<span class="dv">1</span>], susceptibility_range[<span class="dv">2</span>])</span>
<span id="cb25-54"><a href="#cb25-54" aria-hidden="true" tabindex="-1"></a>  mean_suscept <span class="ot">=</span> <span class="fu">mean</span>(susceptibility)</span>
<span id="cb25-55"><a href="#cb25-55" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-56"><a href="#cb25-56" aria-hidden="true" tabindex="-1"></a>  <span class="do">## determine infections</span></span>
<span id="cb25-57"><a href="#cb25-57" aria-hidden="true" tabindex="-1"></a>  <span class="do">## make a dataframe for the outcomes --- random walkers</span></span>
<span id="cb25-58"><a href="#cb25-58" aria-hidden="true" tabindex="-1"></a>  indiv.risk.random <span class="ot">&lt;-</span> <span class="fu">cbind</span>(indiv.risk.random,</span>
<span id="cb25-59"><a href="#cb25-59" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">data.frame</span>( <span class="at">susceptibility =</span> susceptibility)) <span class="sc">%&gt;%</span></span>
<span id="cb25-60"><a href="#cb25-60" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb25-61"><a href="#cb25-61" aria-hidden="true" tabindex="-1"></a>    <span class="do">## predict infections based on exposure risk</span></span>
<span id="cb25-62"><a href="#cb25-62" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">infected_es =</span> <span class="fu">rbinom</span>(<span class="dv">1</span>, <span class="dv">1</span>, exp_risk <span class="sc">*</span> susceptibility ), <span class="co"># sum(exp_risk * susceptibility)</span></span>
<span id="cb25-63"><a href="#cb25-63" aria-hidden="true" tabindex="-1"></a>           <span class="at">infected_e =</span> <span class="fu">rbinom</span>(<span class="dv">1</span>, <span class="dv">1</span>, exp_risk <span class="sc">*</span> mean_suscept)) <span class="co"># sum(exposure risk) alone</span></span>
<span id="cb25-64"><a href="#cb25-64" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-65"><a href="#cb25-65" aria-hidden="true" tabindex="-1"></a>  <span class="do">## make a dataframe for the outcomes --- levy walkers</span></span>
<span id="cb25-66"><a href="#cb25-66" aria-hidden="true" tabindex="-1"></a>  indiv.risk.corr <span class="ot">&lt;-</span> <span class="fu">cbind</span>(indiv.risk.corr,</span>
<span id="cb25-67"><a href="#cb25-67" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">data.frame</span>( <span class="at">susceptibility =</span> susceptibility)) <span class="sc">%&gt;%</span></span>
<span id="cb25-68"><a href="#cb25-68" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb25-69"><a href="#cb25-69" aria-hidden="true" tabindex="-1"></a>    <span class="do">## predict infections based on exposure risk</span></span>
<span id="cb25-70"><a href="#cb25-70" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">infected_es =</span> <span class="fu">rbinom</span>(<span class="dv">1</span>, <span class="dv">1</span>, exp_risk <span class="sc">*</span> susceptibility ), <span class="co"># sum(exp_risk * susceptibility)</span></span>
<span id="cb25-71"><a href="#cb25-71" aria-hidden="true" tabindex="-1"></a>           <span class="at">infected_e =</span> <span class="fu">rbinom</span>(<span class="dv">1</span>, <span class="dv">1</span>, exp_risk <span class="sc">*</span> mean_suscept)) <span class="co"># sum(exposure risk) alone</span></span>
<span id="cb25-72"><a href="#cb25-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-73"><a href="#cb25-73" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-74"><a href="#cb25-74" aria-hidden="true" tabindex="-1"></a>  <span class="do">## output predictive accuracy</span></span>
<span id="cb25-75"><a href="#cb25-75" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(<span class="at">walker =</span> <span class="fu">c</span>(<span class="st">"Random"</span>, <span class="st">"Random"</span>, <span class="st">"Correlated"</span>, <span class="st">"Correlated"</span>),</span>
<span id="cb25-76"><a href="#cb25-76" aria-hidden="true" tabindex="-1"></a>           <span class="at">susceptibility =</span> <span class="fu">c</span>(<span class="st">"Fixed"</span>, <span class="st">"Random"</span>, <span class="st">"Fixed"</span>, <span class="st">"Random"</span>),</span>
<span id="cb25-77"><a href="#cb25-77" aria-hidden="true" tabindex="-1"></a>           <span class="at">accuracy =</span> <span class="fu">c</span>(<span class="fu">pred_acc_fun</span>(indiv.risk.random, <span class="st">"infected_e"</span>),</span>
<span id="cb25-78"><a href="#cb25-78" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">pred_acc_fun</span>(indiv.risk.random, <span class="st">"infected_es"</span>),</span>
<span id="cb25-79"><a href="#cb25-79" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">pred_acc_fun</span>(indiv.risk.corr, <span class="st">"infected_e"</span>),</span>
<span id="cb25-80"><a href="#cb25-80" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">pred_acc_fun</span>(indiv.risk.corr, <span class="st">"infected_es"</span>)</span>
<span id="cb25-81"><a href="#cb25-81" aria-hidden="true" tabindex="-1"></a>                        ))</span>
<span id="cb25-82"><a href="#cb25-82" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Check that the function works when run one time. By default the simulation uses the riskmap, aoi, resistance raster, and random and levy walker walks set up previously. The default number of steps in each walk is 1000, for 100 individuals, with susceptibility [0.7, 0.9] as used previously.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="do">## check it works running one time</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="fu">simulation_fun</span>() <span class="sc">%&gt;%</span> knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="at">title =</span> <span class="st">"Results of one simulation using the function"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">walker</th>
<th style="text-align: left;">susceptibility</th>
<th style="text-align: right;">accuracy</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Random</td>
<td style="text-align: left;">Fixed</td>
<td style="text-align: right;">0.79</td>
</tr>
<tr class="even">
<td style="text-align: left;">Random</td>
<td style="text-align: left;">Random</td>
<td style="text-align: right;">0.78</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Correlated</td>
<td style="text-align: left;">Fixed</td>
<td style="text-align: right;">0.68</td>
</tr>
<tr class="even">
<td style="text-align: left;">Correlated</td>
<td style="text-align: left;">Random</td>
<td style="text-align: right;">0.71</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Then run the function 100 times.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="do">## fun the function many times</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>lg_sim <span class="ot">&lt;-</span> <span class="fu">replicate</span>(<span class="dv">100</span>, <span class="fu">simulation_fun</span>(), <span class="at">simplify =</span> F)</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="do">## make the output into one large dataframe</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>lg_sim <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(lg_sim)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The distributions of the accuracy of models that use cumulative exposure to predict infection show that as expected random walkers infections are predicted with higher accuracy, and that the effect of variable susceptibility to infection in each individual lower the accuracy of correlated walks more than random walks.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="do">## plot the distribution of predictive values between the fix susceptibility random and correlated walks</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>lg_sim <span class="sc">%&gt;%</span> </span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>accuracy, <span class="at">fill=</span>walker)) <span class="sc">+</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">adjust =</span><span class="fl">1.5</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">"Pastel1"</span>)<span class="sc">+</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>susceptibility, <span class="at">ncol=</span><span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Accuracy of Infection Estimates"</span>,</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Fixed vs random susceptibility"</span>,</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">"Walk type"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-38-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The predictive accuracy of the simulations that used the fixed susceptibility values for all individuals (infection is only related to cumulative exposure risk) is significantly higher in random walkers then correlated walkers.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="do">## plot the distribution of predictive values between the fix susceptibility random and correlated walks</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>lg_sim <span class="sc">%&gt;%</span> </span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(susceptibility <span class="sc">==</span> <span class="st">"Fixed"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>accuracy, <span class="at">fill=</span>walker)) <span class="sc">+</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">adjust =</span><span class="fl">1.5</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">"Pastel1"</span>)<span class="sc">+</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Accuracy of Infection ~ Cummulative Exposure"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-39-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="do">## test if significantly different</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>lg_sim <span class="sc">%&gt;%</span> </span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(susceptibility <span class="sc">==</span> <span class="st">"Fixed"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">t.test</span>(accuracy <span class="sc">~</span> walker, <span class="at">data =</span> ., <span class="at">var.equal =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Two Sample t-test

data:  accuracy by walker
t = -12.912, df = 198, p-value &lt; 2.2e-16
alternative hypothesis: true difference in means between group Correlated and group Random is not equal to 0
95 percent confidence interval:
 -0.09083536 -0.06676464
sample estimates:
mean in group Correlated     mean in group Random 
                  0.6973                   0.7761 </code></pre>
</div>
</div>
<p>The same effect is seen in the randomly assigned individual susceptibility random and correlated walkers.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="do">## plot the distributions of predictive values between the variable susceptibility random and correlated walks</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>lg_sim <span class="sc">%&gt;%</span> </span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(susceptibility <span class="sc">==</span> <span class="st">"Random"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>accuracy, <span class="at">fill=</span>walker)) <span class="sc">+</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">adjust =</span><span class="fl">1.5</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">"Pastel1"</span>)<span class="sc">+</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Accuracy of Infection ~ Cummulative Exposure*Susceptibility"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-40-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="do">## test if significantly different</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>lg_sim <span class="sc">%&gt;%</span> </span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(susceptibility <span class="sc">==</span> <span class="st">"Random"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">t.test</span>(accuracy <span class="sc">~</span> walker, <span class="at">data =</span> ., <span class="at">var.equal =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Two Sample t-test

data:  accuracy by walker
t = -11.91, df = 198, p-value &lt; 2.2e-16
alternative hypothesis: true difference in means between group Correlated and group Random is not equal to 0
95 percent confidence interval:
 -0.088467 -0.063333
sample estimates:
mean in group Correlated     mean in group Random 
                  0.6983                   0.7742 </code></pre>
</div>
</div>
</section>
<section id="conclusion" class="level1">
<h1>Conclusion</h1>
<p>To wrap up the simulation showed that predicting individual infection probability as defined by their cumulative exposure risk, is influence by the amount of noise in that dataset such as we would expect to observe due to variability in individual’s susceptibility to infection. Future directions include rerunning this simulation over different susceptibility windows and using predictors that correlate with, but are not the ‘real’ risk landscape.</p>
</section>
<section id="references" class="level1">



<!-- -->


</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" role="list">
<div id="ref-albery2022" class="csl-entry" role="listitem">
Albery, Gregory F., Amy R. Sweeny, Daniel J. Becker, and Shweta Bansal. 2022. <span>“Fine-Scale Spatial Patterns of Wildlife Disease Are Common and Understudied.”</span> <em>Functional Ecology</em> 36 (1): 214–25. <a href="https://doi.org/10.1111/1365-2435.13942">https://doi.org/10.1111/1365-2435.13942</a>.
</div>
<div id="ref-reynolds2010" class="csl-entry" role="listitem">
Reynolds, Andy M. 2010. <span>“Bridging the Gulf Between Correlated Random Walks and Lévy Walks: Autocorrelation as a Source of Lévy Walk Movement Patterns.”</span> <em>Journal of The Royal Society Interface</em> 7 (53): 1753–58. <a href="https://doi.org/10.1098/rsif.2010.0292">https://doi.org/10.1098/rsif.2010.0292</a>.
</div>
<div id="ref-sweeny2022" class="csl-entry" role="listitem">
Sweeny, Amy R., and Gregory F. Albery. 2022. <span>“Exposure and Susceptibility: The Twin Pillars of Infection.”</span> <em>Functional Ecology</em> 36 (7): 1713–26. <a href="https://doi.org/10.1111/1365-2435.14065">https://doi.org/10.1111/1365-2435.14065</a>.
</div>
<div id="ref-titcomb2021" class="csl-entry" role="listitem">
Titcomb, Georgia, John Naisikie Mantas, Jenna Hulke, Ivan Rodriguez, Douglas Branch, and Hillary Young. 2021. <span>“Water Sources Aggregate Parasites with Increasing Effects in More Arid Conditions.”</span> <em>Nature Communications</em> 12 (1). <a href="https://doi.org/10.1038/s41467-021-27352-y">https://doi.org/10.1038/s41467-021-27352-y</a>.
</div>
<div id="ref-turchin1998" class="csl-entry" role="listitem">
Turchin, Peter. 1998. <span>“Quantitative Analysis of Movement: Measuring and Modeling Population Redistribution in Animals and Plants.”</span> <em>The Quarterly Review of Biology</em> 74 (2): 240–41. <a href="https://doi.org/10.1086/393125">https://doi.org/10.1086/393125</a>.
</div>
<div id="ref-weinstein2018" class="csl-entry" role="listitem">
Weinstein, Sara B., Julia C. Buck, and Hillary S. Young. 2018. <span>“A Landscape of Disgust.”</span> <em>Science</em> 359 (6381): 1213–14. <a href="https://doi.org/10.1126/science.aas8694">https://doi.org/10.1126/science.aas8694</a>.
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb35" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Simulation of Realized Infection Risk"</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="an">description:</span><span class="co"> "simulate a probability distribution of risk"</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="co">  - name: Kayla Kauffman</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a><span class="co">    url: https://https://kmkauffm.github.io/</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a><span class="co">    orcid: 0000-0002-4897-9428</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-location: left</span></span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a><span class="co">    message: false</span></span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a><span class="co">    warning: false</span></span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: true</span></span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a><span class="co">    theme: sandstone</span></span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a><span class="an">bibliography:</span><span class="co"> references.bib</span></span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> 2023-12-15</span></span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a><span class="an">categories:</span><span class="co"> [R, code, simulations] # self-defined categories</span></span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a><span class="an">image:</span><span class="co"> schema.png</span></span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a><span class="an">draft:</span><span class="co"> false # setting this to `true` will prevent your post from appearing on your listing page until you're ready!</span></span>
<span id="cb35-22"><a href="#cb35-22" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb35-23"><a href="#cb35-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-24"><a href="#cb35-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-27"><a href="#cb35-27" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-28"><a href="#cb35-28" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb35-29"><a href="#cb35-29" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb35-30"><a href="#cb35-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-31"><a href="#cb35-31" aria-hidden="true" tabindex="-1"></a><span class="co"># library(spDataLarge)</span></span>
<span id="cb35-32"><a href="#cb35-32" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb35-33"><a href="#cb35-33" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb35-34"><a href="#cb35-34" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(terra)</span>
<span id="cb35-35"><a href="#cb35-35" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(SiMRiv)</span>
<span id="cb35-36"><a href="#cb35-36" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb35-37"><a href="#cb35-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-38"><a href="#cb35-38" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>(<span class="fu">theme_bw</span>())</span>
<span id="cb35-39"><a href="#cb35-39" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_update</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb35-40"><a href="#cb35-40" aria-hidden="true" tabindex="-1"></a>             <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>))</span>
<span id="cb35-41"><a href="#cb35-41" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-42"><a href="#cb35-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-43"><a href="#cb35-43" aria-hidden="true" tabindex="-1"></a><span class="fu"># Introduction</span></span>
<span id="cb35-44"><a href="#cb35-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-45"><a href="#cb35-45" aria-hidden="true" tabindex="-1"></a>My research broadly addresses how land use change impact zoonotic disease sharing patterns between wildlife, domestic animals and people. One aspect of this research delves into how well a landscape of risk <span class="co">[</span><span class="ot">@weinstein2018</span><span class="co">]</span> can be predicted across space and time <span class="co">[</span><span class="ot">@albery2022</span><span class="co">]</span>, and if people that spend more time in areas of high pathogen prevalence on the landscape are more likely to be infected with that parasite. The landscape of risk is the variation in pathogen density or pressure across the landscape, and the underlying environmental characteristics that permit pathogen persistence and onward transmission to susceptible individuals visiting that area (e.g., <span class="co">[</span><span class="ot">@titcomb2021</span><span class="co">]</span>).</span>
<span id="cb35-46"><a href="#cb35-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-47"><a href="#cb35-47" aria-hidden="true" tabindex="-1"></a>Prior to doing this with actual data I want to set up a simulation so I can figure out some of the methods using a simplified scenario. In particular I am interested in comparing how noise in the dataset due to the variability in individuals home range sizes and susceptibility to infection affect my ability to associate cumulative exposure risk to infection probability. For my purposes here susceptibility encompasses variability in behavior of individuals that influence pathogen exposure, immunological function, genetics, etc <span class="co">[</span><span class="ot">@sweeny2022</span><span class="co">]</span>.</span>
<span id="cb35-48"><a href="#cb35-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-49"><a href="#cb35-49" aria-hidden="true" tabindex="-1"></a><span class="fu"># Risk Map</span></span>
<span id="cb35-50"><a href="#cb35-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-51"><a href="#cb35-51" aria-hidden="true" tabindex="-1"></a>I am using the elevation raster of Zion National Park included in the <span class="in">`spDataLarge`</span> package as the landscape risk map. The thought behind using this and not simply a simulated raster is to have highly variable patterns and spatial autocorrelation. However to use this, I need the values to fall between 0 and 1. This is what the original maps looks like with the scaled values.</span>
<span id="cb35-52"><a href="#cb35-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-55"><a href="#cb35-55" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-56"><a href="#cb35-56" aria-hidden="true" tabindex="-1"></a><span class="do">## load the data from the spDataLarge package</span></span>
<span id="cb35-57"><a href="#cb35-57" aria-hidden="true" tabindex="-1"></a>riskmap <span class="ot">&lt;-</span> <span class="fu">rast</span>(<span class="fu">system.file</span>(<span class="st">"raster/srtm.tif"</span>, <span class="at">package =</span> <span class="st">"spDataLarge"</span>))</span>
<span id="cb35-58"><a href="#cb35-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-59"><a href="#cb35-59" aria-hidden="true" tabindex="-1"></a><span class="do">## project in utm so easier units for making the simulated tracks</span></span>
<span id="cb35-60"><a href="#cb35-60" aria-hidden="true" tabindex="-1"></a>riskmap <span class="ot">&lt;-</span> <span class="fu">project</span>(riskmap, <span class="st">"EPSG:26912"</span>)</span>
<span id="cb35-61"><a href="#cb35-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-62"><a href="#cb35-62" aria-hidden="true" tabindex="-1"></a><span class="do">## make values [0,1]</span></span>
<span id="cb35-63"><a href="#cb35-63" aria-hidden="true" tabindex="-1"></a>riskmap <span class="ot">&lt;-</span> riskmap<span class="sc">/</span><span class="fu">max</span>(<span class="fu">values</span>(riskmap), <span class="at">na.rm=</span>T)</span>
<span id="cb35-64"><a href="#cb35-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-65"><a href="#cb35-65" aria-hidden="true" tabindex="-1"></a><span class="do">## most places should be pretty low</span></span>
<span id="cb35-66"><a href="#cb35-66" aria-hidden="true" tabindex="-1"></a><span class="do">## look at the 'original values'</span></span>
<span id="cb35-67"><a href="#cb35-67" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb35-68"><a href="#cb35-68" aria-hidden="true" tabindex="-1"></a>  stars<span class="sc">::</span><span class="fu">geom_stars</span>(<span class="at">data =</span> stars<span class="sc">::</span><span class="fu">st_as_stars</span>(riskmap)) <span class="sc">+</span></span>
<span id="cb35-69"><a href="#cb35-69" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>() <span class="sc">+</span></span>
<span id="cb35-70"><a href="#cb35-70" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_fixed</span>() <span class="sc">+</span></span>
<span id="cb35-71"><a href="#cb35-71" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="cn">NULL</span>, <span class="at">y=</span><span class="cn">NULL</span>, <span class="at">fill =</span> <span class="st">"elevation scaled [0,1]"</span>, <span class="at">title =</span> <span class="st">"Origional Elevation Map"</span>) <span class="sc">+</span></span>
<span id="cb35-72"><a href="#cb35-72" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text =</span> <span class="fu">element_blank</span>()) <span class="co"># since don't care about location</span></span>
<span id="cb35-73"><a href="#cb35-73" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-74"><a href="#cb35-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-75"><a href="#cb35-75" aria-hidden="true" tabindex="-1"></a>I want the values to be right skewed so that most places are low risk. So I transformed the values to values^3^ in my scaled raster to get the desired distribution of risk (pathogen density) in my risk map.</span>
<span id="cb35-76"><a href="#cb35-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-79"><a href="#cb35-79" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-80"><a href="#cb35-80" aria-hidden="true" tabindex="-1"></a><span class="do">## histogram of value distribution</span></span>
<span id="cb35-81"><a href="#cb35-81" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">values</span>(riskmap) <span class="sc">%&gt;%</span> </span>
<span id="cb35-82"><a href="#cb35-82" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb35-83"><a href="#cb35-83" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.finite</span>(srtm)) <span class="sc">%&gt;%</span> </span>
<span id="cb35-84"><a href="#cb35-84" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb35-85"><a href="#cb35-85" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">x=</span>srtm)) <span class="sc">+</span></span>
<span id="cb35-86"><a href="#cb35-86" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"cell values"</span>, <span class="at">y =</span> <span class="st">"frequency"</span>, <span class="at">title =</span> <span class="st">"Origional risk map values [0,1]"</span>)</span>
<span id="cb35-87"><a href="#cb35-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-88"><a href="#cb35-88" aria-hidden="true" tabindex="-1"></a><span class="do">## add right skew to values so most are low</span></span>
<span id="cb35-89"><a href="#cb35-89" aria-hidden="true" tabindex="-1"></a>riskmap <span class="ot">&lt;-</span> riskmap<span class="sc">^</span><span class="dv">3</span></span>
<span id="cb35-90"><a href="#cb35-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-91"><a href="#cb35-91" aria-hidden="true" tabindex="-1"></a><span class="do">## plots to commpare old and new value distributions</span></span>
<span id="cb35-92"><a href="#cb35-92" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">values</span>(riskmap) <span class="sc">%&gt;%</span> </span>
<span id="cb35-93"><a href="#cb35-93" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb35-94"><a href="#cb35-94" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb35-95"><a href="#cb35-95" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">x=</span>srtm)) <span class="sc">+</span></span>
<span id="cb35-96"><a href="#cb35-96" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"cell values"</span>, <span class="at">y =</span> <span class="st">"frequency"</span>, <span class="at">title =</span> <span class="st">"Skewed risk map values [0,1]"</span>)</span>
<span id="cb35-97"><a href="#cb35-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-98"><a href="#cb35-98" aria-hidden="true" tabindex="-1"></a><span class="do">## plot old and new next to each other</span></span>
<span id="cb35-99"><a href="#cb35-99" aria-hidden="true" tabindex="-1"></a>p1<span class="sc">+</span>p2</span>
<span id="cb35-100"><a href="#cb35-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-101"><a href="#cb35-101" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-102"><a href="#cb35-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-105"><a href="#cb35-105" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-106"><a href="#cb35-106" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false</span></span>
<span id="cb35-107"><a href="#cb35-107" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(p1, p2)</span>
<span id="cb35-108"><a href="#cb35-108" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-109"><a href="#cb35-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-110"><a href="#cb35-110" aria-hidden="true" tabindex="-1"></a>To make things run quickly, I aggregated the risk map so the resolution is lower. Then cropped the map to a squarer area so individuals don't fall outside of the area with values (the grey parts of the map above).</span>
<span id="cb35-111"><a href="#cb35-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-114"><a href="#cb35-114" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-115"><a href="#cb35-115" aria-hidden="true" tabindex="-1"></a><span class="do">## make resolution lower so things run quickly</span></span>
<span id="cb35-116"><a href="#cb35-116" aria-hidden="true" tabindex="-1"></a>riskmap <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(riskmap, <span class="at">fact=</span><span class="dv">5</span>, <span class="at">fun=</span><span class="st">"mean"</span>)</span>
<span id="cb35-117"><a href="#cb35-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-118"><a href="#cb35-118" aria-hidden="true" tabindex="-1"></a><span class="do">## make square</span></span>
<span id="cb35-119"><a href="#cb35-119" aria-hidden="true" tabindex="-1"></a>tmp <span class="ot">&lt;-</span> <span class="fu">vect</span>(<span class="fu">ext</span>(riskmap)<span class="sc">-</span><span class="dv">1500</span>, <span class="at">crs=</span><span class="fu">crs</span>(riskmap))</span>
<span id="cb35-120"><a href="#cb35-120" aria-hidden="true" tabindex="-1"></a>riskmap <span class="ot">&lt;-</span> <span class="fu">crop</span>(riskmap, tmp)</span>
<span id="cb35-121"><a href="#cb35-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-122"><a href="#cb35-122" aria-hidden="true" tabindex="-1"></a><span class="do">## plot the new lower resolution map</span></span>
<span id="cb35-123"><a href="#cb35-123" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb35-124"><a href="#cb35-124" aria-hidden="true" tabindex="-1"></a>  stars<span class="sc">::</span><span class="fu">geom_stars</span>(<span class="at">data =</span> stars<span class="sc">::</span><span class="fu">st_as_stars</span>(riskmap)) <span class="sc">+</span></span>
<span id="cb35-125"><a href="#cb35-125" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">option =</span> <span class="st">"H"</span>) <span class="sc">+</span></span>
<span id="cb35-126"><a href="#cb35-126" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_fixed</span>() <span class="sc">+</span></span>
<span id="cb35-127"><a href="#cb35-127" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="cn">NULL</span>, <span class="at">y=</span><span class="cn">NULL</span>, <span class="at">fill =</span> <span class="st">"risk level"</span>, <span class="at">title =</span> <span class="st">"Risk Map"</span>) <span class="sc">+</span></span>
<span id="cb35-128"><a href="#cb35-128" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text =</span> <span class="fu">element_blank</span>()) <span class="co"># since don't care about location</span></span>
<span id="cb35-129"><a href="#cb35-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-130"><a href="#cb35-130" aria-hidden="true" tabindex="-1"></a><span class="do">## check the data structure</span></span>
<span id="cb35-131"><a href="#cb35-131" aria-hidden="true" tabindex="-1"></a><span class="co"># riskmap</span></span>
<span id="cb35-132"><a href="#cb35-132" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-133"><a href="#cb35-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-136"><a href="#cb35-136" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-137"><a href="#cb35-137" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false</span></span>
<span id="cb35-138"><a href="#cb35-138" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(tmp)</span>
<span id="cb35-139"><a href="#cb35-139" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-140"><a href="#cb35-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-141"><a href="#cb35-141" aria-hidden="true" tabindex="-1"></a><span class="fu"># Single simulation</span></span>
<span id="cb35-142"><a href="#cb35-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-143"><a href="#cb35-143" aria-hidden="true" tabindex="-1"></a>I am using a single simulation to figure out how to set up the simulation and to outline the process involved in the simulation. Once that is ironed out, I'll put everything into a single function so I can repeat the simulation many times and get confidence intervals for my estimated effects.</span>
<span id="cb35-144"><a href="#cb35-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-145"><a href="#cb35-145" aria-hidden="true" tabindex="-1"></a><span class="fu">## Simulate movement</span></span>
<span id="cb35-146"><a href="#cb35-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-147"><a href="#cb35-147" aria-hidden="true" tabindex="-1"></a>To simulate movement of individuals I followed the <span class="co">[</span><span class="ot">`SiMRiv` vignette</span><span class="co">](https://cran.r-project.org/web/packages/SiMRiv/vignettes/SiMRiv.pdf)</span>. I wanted to have two types of movement to use in my simulation. I am calling these:</span>
<span id="cb35-148"><a href="#cb35-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-149"><a href="#cb35-149" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Simple random walk** - Single-state uncorrelated movement in an homogeneous landscape using Brownian motion <span class="co">[</span><span class="ot">@turchin1998</span><span class="co">]</span> to make individuals 'vibrate' in place. Movement of only this type is the 'null' state because an individual essentially staying in one place will have an exposure risk equal to their singular location. This state will be used to demonstrate that an individual's probability of infection is proportional to their exposures.\</span>
<span id="cb35-150"><a href="#cb35-150" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Complex correlated walk** - Multistate correlated movement in a heterogeneous landscape using Levy walk-like movement with two-state movements composed of small random walks and bursts of longer correlated random walks <span class="co">[</span><span class="ot">@reynolds2010</span><span class="co">]</span>. A heterogeneous landscape is used to makes some areas high resistance, thus the population's movements will look more similar, since most movement will follow low resistance 'paths' (roads), but individuals will still randomly branch off into higher resistance areas.</span>
<span id="cb35-151"><a href="#cb35-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-152"><a href="#cb35-152" aria-hidden="true" tabindex="-1"></a>An important part of simulating movement is the step length, which need to be relevant to the animal and the resolution of the raster. To limit movement in the simple random walk, make step sizes 1/20th of the resolution of the risk map. Find the resolution of the risk map. The resolution show help with choosing a step length that is relative to the pixel sizes so that individuals can move, but not too much within a given step. Steps of \~1/10 a pixel seem reasonable.</span>
<span id="cb35-153"><a href="#cb35-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-156"><a href="#cb35-156" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-157"><a href="#cb35-157" aria-hidden="true" tabindex="-1"></a><span class="do">## save cell size</span></span>
<span id="cb35-158"><a href="#cb35-158" aria-hidden="true" tabindex="-1"></a>cell_size <span class="ot">=</span> <span class="fu">res</span>(riskmap)[<span class="dv">1</span>]</span>
<span id="cb35-159"><a href="#cb35-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-160"><a href="#cb35-160" aria-hidden="true" tabindex="-1"></a><span class="do">## number of steps</span></span>
<span id="cb35-161"><a href="#cb35-161" aria-hidden="true" tabindex="-1"></a>nsteps <span class="ot">=</span> <span class="dv">1000</span></span>
<span id="cb35-162"><a href="#cb35-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-163"><a href="#cb35-163" aria-hidden="true" tabindex="-1"></a><span class="do">## random walk with step lengths relative to rast resolution</span></span>
<span id="cb35-164"><a href="#cb35-164" aria-hidden="true" tabindex="-1"></a>rand.walk <span class="ot">&lt;-</span> <span class="fu">state</span>(<span class="at">concentration =</span> <span class="dv">0</span>, <span class="co">#turning angle concentration; 0=random</span></span>
<span id="cb35-165"><a href="#cb35-165" aria-hidden="true" tabindex="-1"></a>                             <span class="at">pwind =</span> <span class="fu">perceptualRange</span>(<span class="st">"gaussian"</span>, <span class="co"># centered on indiv's position</span></span>
<span id="cb35-166"><a href="#cb35-166" aria-hidden="true" tabindex="-1"></a>                                                     cell_size<span class="sc">/</span><span class="dv">5</span>), <span class="do">## radius of perceptual range 1/4 of steplength</span></span>
<span id="cb35-167"><a href="#cb35-167" aria-hidden="true" tabindex="-1"></a>                             <span class="at">steplen =</span> cell_size<span class="sc">/</span><span class="dv">20</span>, <span class="co">#maximum step length</span></span>
<span id="cb35-168"><a href="#cb35-168" aria-hidden="true" tabindex="-1"></a>                             <span class="at">name =</span> <span class="st">"tight_random"</span>) <span class="co">#name of the state</span></span>
<span id="cb35-169"><a href="#cb35-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-170"><a href="#cb35-170" aria-hidden="true" tabindex="-1"></a><span class="do">## correlated walk with step lengths relative to rast resolutions</span></span>
<span id="cb35-171"><a href="#cb35-171" aria-hidden="true" tabindex="-1"></a>corr.walk <span class="ot">&lt;-</span> <span class="fu">state</span>(<span class="at">concentration =</span> <span class="fl">0.9</span>, <span class="co">#turning angle concentration; 1=straight line</span></span>
<span id="cb35-172"><a href="#cb35-172" aria-hidden="true" tabindex="-1"></a>                             <span class="at">pwind =</span> <span class="fu">perceptualRange</span>(<span class="st">"circular"</span>, <span class="co"># gives equal weight to all pixels centered on current position</span></span>
<span id="cb35-173"><a href="#cb35-173" aria-hidden="true" tabindex="-1"></a>                                                     cell_size<span class="sc">*</span><span class="dv">2</span>), <span class="do">## radius of perceptual range 1/4 of steplength</span></span>
<span id="cb35-174"><a href="#cb35-174" aria-hidden="true" tabindex="-1"></a>                             <span class="at">steplen =</span> cell_size<span class="sc">/</span><span class="dv">5</span>, <span class="co">#maximum step length</span></span>
<span id="cb35-175"><a href="#cb35-175" aria-hidden="true" tabindex="-1"></a>                             <span class="at">name =</span> <span class="st">"correlated"</span>) <span class="co">#name of the state</span></span>
<span id="cb35-176"><a href="#cb35-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-177"><a href="#cb35-177" aria-hidden="true" tabindex="-1"></a><span class="do">## using those states make walkers</span></span>
<span id="cb35-178"><a href="#cb35-178" aria-hidden="true" tabindex="-1"></a>rand.walker <span class="ot">&lt;-</span> <span class="fu">species</span>(<span class="at">states =</span> rand.walk)</span>
<span id="cb35-179"><a href="#cb35-179" aria-hidden="true" tabindex="-1"></a><span class="do">## set up levy walker walk</span></span>
<span id="cb35-180"><a href="#cb35-180" aria-hidden="true" tabindex="-1"></a>levy.walker <span class="ot">&lt;-</span> <span class="fu">species</span>(<span class="at">states =</span> <span class="fu">c</span>(rand.walk,</span>
<span id="cb35-181"><a href="#cb35-181" aria-hidden="true" tabindex="-1"></a>                                  corr.walk),</span>
<span id="cb35-182"><a href="#cb35-182" aria-hidden="true" tabindex="-1"></a>                       <span class="at">trans =</span> <span class="fu">transitionMatrix</span>(<span class="fl">0.05</span>, <span class="fl">0.01</span>)) <span class="co">#probabilities of changing state 1 -&gt; 2 and 2 -&gt; 1</span></span>
<span id="cb35-183"><a href="#cb35-183" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-184"><a href="#cb35-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-185"><a href="#cb35-185" aria-hidden="true" tabindex="-1"></a><span class="fu">### Simple random walk</span></span>
<span id="cb35-186"><a href="#cb35-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-187"><a href="#cb35-187" aria-hidden="true" tabindex="-1"></a>I simulated the simple random walks for 100 individuals all starting at randomly selected areas with in an area of interest (aoi). Because individuals can run off the edge of the raster, the starting locations should not be near the edge. The area of interest is the white rectangle, with each point representing an individual's starting location.</span>
<span id="cb35-188"><a href="#cb35-188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-191"><a href="#cb35-191" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-192"><a href="#cb35-192" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb35-193"><a href="#cb35-193" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb35-194"><a href="#cb35-194" aria-hidden="true" tabindex="-1"></a><span class="do">## generate random starting points </span></span>
<span id="cb35-195"><a href="#cb35-195" aria-hidden="true" tabindex="-1"></a><span class="do">### avoid edges by defining area of interest more inside the risk map</span></span>
<span id="cb35-196"><a href="#cb35-196" aria-hidden="true" tabindex="-1"></a><span class="do">### find bounding box of risk map</span></span>
<span id="cb35-197"><a href="#cb35-197" aria-hidden="true" tabindex="-1"></a>aoi <span class="ot">&lt;-</span> <span class="fu">st_bbox</span>(riskmap)</span>
<span id="cb35-198"><a href="#cb35-198" aria-hidden="true" tabindex="-1"></a><span class="do">### make insto sfc (spatial) object</span></span>
<span id="cb35-199"><a href="#cb35-199" aria-hidden="true" tabindex="-1"></a>aoi <span class="ot">&lt;-</span> <span class="fu">st_as_sfc</span>(aoi)</span>
<span id="cb35-200"><a href="#cb35-200" aria-hidden="true" tabindex="-1"></a><span class="do">### buffer to be 5 cells from edge of riskmap</span></span>
<span id="cb35-201"><a href="#cb35-201" aria-hidden="true" tabindex="-1"></a>aoi <span class="ot">&lt;-</span> <span class="fu">st_buffer</span>(aoi, <span class="sc">-</span>cell_size<span class="sc">*</span><span class="dv">5</span>)</span>
<span id="cb35-202"><a href="#cb35-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-203"><a href="#cb35-203" aria-hidden="true" tabindex="-1"></a><span class="co"># aoi &lt;- crop(riskmap, aoi)</span></span>
<span id="cb35-204"><a href="#cb35-204" aria-hidden="true" tabindex="-1"></a><span class="co"># ggplot() +</span></span>
<span id="cb35-205"><a href="#cb35-205" aria-hidden="true" tabindex="-1"></a><span class="co">#   stars::geom_stars(data = stars::st_as_stars(riskmap)) +</span></span>
<span id="cb35-206"><a href="#cb35-206" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_fill_viridis_c(option = "H") +</span></span>
<span id="cb35-207"><a href="#cb35-207" aria-hidden="true" tabindex="-1"></a><span class="co">#   coord_fixed() +</span></span>
<span id="cb35-208"><a href="#cb35-208" aria-hidden="true" tabindex="-1"></a><span class="co">#   labs(x=NULL, y=NULL, fill = "risk level", title = "Area of interest for starting locations on Risk Map") +</span></span>
<span id="cb35-209"><a href="#cb35-209" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme(axis.text = element_blank()) +# since don't care about location</span></span>
<span id="cb35-210"><a href="#cb35-210" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_sf(data = aoi, fill = "white", alpha = 0.3, color = "white", lwd = 1)</span></span>
<span id="cb35-211"><a href="#cb35-211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-212"><a href="#cb35-212" aria-hidden="true" tabindex="-1"></a>start_coord <span class="ot">&lt;-</span> <span class="fu">st_sample</span>(aoi, <span class="dv">100</span>, <span class="at">type =</span> <span class="st">"random"</span>)</span>
<span id="cb35-213"><a href="#cb35-213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-214"><a href="#cb35-214" aria-hidden="true" tabindex="-1"></a><span class="do">## plot it</span></span>
<span id="cb35-215"><a href="#cb35-215" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb35-216"><a href="#cb35-216" aria-hidden="true" tabindex="-1"></a>  stars<span class="sc">::</span><span class="fu">geom_stars</span>(<span class="at">data =</span> stars<span class="sc">::</span><span class="fu">st_as_stars</span>(riskmap)) <span class="sc">+</span></span>
<span id="cb35-217"><a href="#cb35-217" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">option =</span> <span class="st">"H"</span>) <span class="sc">+</span></span>
<span id="cb35-218"><a href="#cb35-218" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_fixed</span>() <span class="sc">+</span></span>
<span id="cb35-219"><a href="#cb35-219" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="cn">NULL</span>, <span class="at">y=</span><span class="cn">NULL</span>, <span class="at">fill =</span> <span class="st">"risk level"</span>, <span class="at">title =</span> <span class="st">"Random walk starting locations"</span>) <span class="sc">+</span></span>
<span id="cb35-220"><a href="#cb35-220" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span><span class="co"># since don't care about location</span></span>
<span id="cb35-221"><a href="#cb35-221" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> aoi, <span class="at">fill =</span> <span class="st">"white"</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>, <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">lwd =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb35-222"><a href="#cb35-222" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> start_coord)</span>
<span id="cb35-223"><a href="#cb35-223" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-224"><a href="#cb35-224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-225"><a href="#cb35-225" aria-hidden="true" tabindex="-1"></a>The random walks for all the individuals look like my intended "vibrating in place" outcome, such that individuals will spend all their time in just a few pixels, so theoretically their exposure risk is less variable.</span>
<span id="cb35-226"><a href="#cb35-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-229"><a href="#cb35-229" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-230"><a href="#cb35-230" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb35-231"><a href="#cb35-231" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb35-232"><a href="#cb35-232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-233"><a href="#cb35-233" aria-hidden="true" tabindex="-1"></a><span class="do">## need the locations as a nx2 matrix</span></span>
<span id="cb35-234"><a href="#cb35-234" aria-hidden="true" tabindex="-1"></a><span class="co"># start_coord_mat &lt;- as.matrix(as.data.frame(start_coord, geom="xy"))</span></span>
<span id="cb35-235"><a href="#cb35-235" aria-hidden="true" tabindex="-1"></a>start_coord_mat <span class="ot">&lt;-</span> <span class="fu">st_coordinates</span>(start_coord)</span>
<span id="cb35-236"><a href="#cb35-236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-237"><a href="#cb35-237" aria-hidden="true" tabindex="-1"></a><span class="do">## simulate single state walks of 1000 steps</span></span>
<span id="cb35-238"><a href="#cb35-238" aria-hidden="true" tabindex="-1"></a>sim.rw <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb35-239"><a href="#cb35-239" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>) {</span>
<span id="cb35-240"><a href="#cb35-240" aria-hidden="true" tabindex="-1"></a>  <span class="do">## simulate from location i</span></span>
<span id="cb35-241"><a href="#cb35-241" aria-hidden="true" tabindex="-1"></a>  tmp <span class="ot">&lt;-</span> <span class="fu">simulate</span>(rand.walker, nsteps,</span>
<span id="cb35-242"><a href="#cb35-242" aria-hidden="true" tabindex="-1"></a>                   <span class="at">coords =</span> start_coord_mat[i,])</span>
<span id="cb35-243"><a href="#cb35-243" aria-hidden="true" tabindex="-1"></a>  <span class="do">## save results to a list</span></span>
<span id="cb35-244"><a href="#cb35-244" aria-hidden="true" tabindex="-1"></a>  sim.rw[[i]] <span class="ot">&lt;-</span> <span class="fu">cbind</span>(tmp[,<span class="dv">1</span>], tmp[,<span class="dv">2</span>])</span>
<span id="cb35-245"><a href="#cb35-245" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb35-246"><a href="#cb35-246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-247"><a href="#cb35-247" aria-hidden="true" tabindex="-1"></a><span class="do">## make in to sfc lines</span></span>
<span id="cb35-248"><a href="#cb35-248" aria-hidden="true" tabindex="-1"></a>sim.rw.sfc <span class="ot">&lt;-</span> <span class="fu">lapply</span>(sim.rw, st_linestring)</span>
<span id="cb35-249"><a href="#cb35-249" aria-hidden="true" tabindex="-1"></a>sim.rw.sfc <span class="ot">&lt;-</span> <span class="fu">st_sf</span>(<span class="at">id =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>, <span class="at">geometry =</span> sim.rw.sfc) <span class="sc">%&gt;%</span> </span>
<span id="cb35-250"><a href="#cb35-250" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_set_crs</span>(<span class="fu">st_crs</span>(riskmap))</span>
<span id="cb35-251"><a href="#cb35-251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-252"><a href="#cb35-252" aria-hidden="true" tabindex="-1"></a><span class="do">## plot it</span></span>
<span id="cb35-253"><a href="#cb35-253" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb35-254"><a href="#cb35-254" aria-hidden="true" tabindex="-1"></a>  stars<span class="sc">::</span><span class="fu">geom_stars</span>(<span class="at">data =</span> stars<span class="sc">::</span><span class="fu">st_as_stars</span>(riskmap)) <span class="sc">+</span></span>
<span id="cb35-255"><a href="#cb35-255" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">option =</span> <span class="st">"H"</span>) <span class="sc">+</span></span>
<span id="cb35-256"><a href="#cb35-256" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_fixed</span>() <span class="sc">+</span></span>
<span id="cb35-257"><a href="#cb35-257" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="cn">NULL</span>, <span class="at">y=</span><span class="cn">NULL</span>, <span class="at">fill =</span> <span class="st">"risk level"</span>, <span class="at">title =</span> <span class="st">"Random walks"</span>) <span class="sc">+</span></span>
<span id="cb35-258"><a href="#cb35-258" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span><span class="co"># since don't care about location</span></span>
<span id="cb35-259"><a href="#cb35-259" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> sim.rw.sfc)</span>
<span id="cb35-260"><a href="#cb35-260" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-261"><a href="#cb35-261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-264"><a href="#cb35-264" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-265"><a href="#cb35-265" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false</span></span>
<span id="cb35-266"><a href="#cb35-266" aria-hidden="true" tabindex="-1"></a><span class="do">## clean up</span></span>
<span id="cb35-267"><a href="#cb35-267" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(start_coord, sim.rw)</span>
<span id="cb35-268"><a href="#cb35-268" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-269"><a href="#cb35-269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-270"><a href="#cb35-270" aria-hidden="true" tabindex="-1"></a><span class="fu">### Correlated walks</span></span>
<span id="cb35-271"><a href="#cb35-271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-272"><a href="#cb35-272" aria-hidden="true" tabindex="-1"></a>A resistance raster is needed to get correlated (levy walker) walks that are similar between individuals.</span>
<span id="cb35-273"><a href="#cb35-273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-276"><a href="#cb35-276" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-277"><a href="#cb35-277" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb35-278"><a href="#cb35-278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-279"><a href="#cb35-279" aria-hidden="true" tabindex="-1"></a><span class="do">## basemaps for resistance --NOT using because individual end up in a hairball</span></span>
<span id="cb35-280"><a href="#cb35-280" aria-hidden="true" tabindex="-1"></a><span class="co"># landcover &lt;- resistanceFromShape(</span></span>
<span id="cb35-281"><a href="#cb35-281" aria-hidden="true" tabindex="-1"></a><span class="co"># system.file("doc/landcover.shp", package="SiMRiv")</span></span>
<span id="cb35-282"><a href="#cb35-282" aria-hidden="true" tabindex="-1"></a><span class="co"># , res = 50, field = "coverclass", mapvalues = c(</span></span>
<span id="cb35-283"><a href="#cb35-283" aria-hidden="true" tabindex="-1"></a><span class="co"># "forest" = 0.5, "urban" = 1, "dam" = 0</span></span>
<span id="cb35-284"><a href="#cb35-284" aria-hidden="true" tabindex="-1"></a><span class="co"># , "shrubland" = 0.75), background = 0.95)</span></span>
<span id="cb35-285"><a href="#cb35-285" aria-hidden="true" tabindex="-1"></a><span class="co">#  </span></span>
<span id="cb35-286"><a href="#cb35-286" aria-hidden="true" tabindex="-1"></a><span class="do">## river shape is the main resistance, because walks will follow paths</span></span>
<span id="cb35-287"><a href="#cb35-287" aria-hidden="true" tabindex="-1"></a>river.shape <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_read</span>(<span class="fu">system.file</span>(<span class="st">"doc/river-sample.shp"</span>, <span class="at">package=</span><span class="st">"SiMRiv"</span>), <span class="at">quiet =</span> T)</span>
<span id="cb35-288"><a href="#cb35-288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-289"><a href="#cb35-289" aria-hidden="true" tabindex="-1"></a><span class="do">## resistence surface</span></span>
<span id="cb35-290"><a href="#cb35-290" aria-hidden="true" tabindex="-1"></a>resistance <span class="ot">&lt;-</span> <span class="fu">resistanceFromShape</span>(river.shape, <span class="co">#system.file("doc/river-sample.shp", package="SiMRiv"),</span></span>
<span id="cb35-291"><a href="#cb35-291" aria-hidden="true" tabindex="-1"></a>                                       <span class="co"># baseRaster = landcover, ## not using</span></span>
<span id="cb35-292"><a href="#cb35-292" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">res =</span><span class="dv">50</span>, <span class="co">#provide when don't provide basemap</span></span>
<span id="cb35-293"><a href="#cb35-293" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">buffer =</span> <span class="dv">300</span>, <span class="at">field =</span> <span class="fl">0.01</span>,</span>
<span id="cb35-294"><a href="#cb35-294" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">background =</span> <span class="fl">0.75</span>, <span class="at">margin =</span> <span class="dv">3000</span>)</span>
<span id="cb35-295"><a href="#cb35-295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-296"><a href="#cb35-296" aria-hidden="true" tabindex="-1"></a><span class="do">## add central area with low resistence so individuals start in roughly the same place</span></span>
<span id="cb35-297"><a href="#cb35-297" aria-hidden="true" tabindex="-1"></a>river.cent <span class="ot">&lt;-</span> <span class="fu">st_buffer</span>(<span class="fu">st_centroid</span>(<span class="fu">st_union</span>(river.shape)), <span class="dv">200</span>)</span>
<span id="cb35-298"><a href="#cb35-298" aria-hidden="true" tabindex="-1"></a>resistance <span class="ot">&lt;-</span> <span class="fu">resistanceFromShape</span>(river.cent, </span>
<span id="cb35-299"><a href="#cb35-299" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">baseRaster =</span> resistance, </span>
<span id="cb35-300"><a href="#cb35-300" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">buffer =</span> <span class="dv">1000</span>, <span class="at">field =</span> <span class="dv">0</span>, </span>
<span id="cb35-301"><a href="#cb35-301" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">background =</span> <span class="dv">1</span>, <span class="at">margin =</span> <span class="dv">3000</span>)</span>
<span id="cb35-302"><a href="#cb35-302" aria-hidden="true" tabindex="-1"></a><span class="co"># buffer here is just some magical function to convert river</span></span>
<span id="cb35-303"><a href="#cb35-303" aria-hidden="true" tabindex="-1"></a><span class="co"># order into a meaningful value in the [0, 1] range!</span></span>
<span id="cb35-304"><a href="#cb35-304" aria-hidden="true" tabindex="-1"></a><span class="co"># plot(resistance, axes = F, main="resistence raster")</span></span>
<span id="cb35-305"><a href="#cb35-305" aria-hidden="true" tabindex="-1"></a><span class="co"># resistance</span></span>
<span id="cb35-306"><a href="#cb35-306" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-307"><a href="#cb35-307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-310"><a href="#cb35-310" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-311"><a href="#cb35-311" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false</span></span>
<span id="cb35-312"><a href="#cb35-312" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(river.shape, river.cent)</span>
<span id="cb35-313"><a href="#cb35-313" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-314"><a href="#cb35-314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-315"><a href="#cb35-315" aria-hidden="true" tabindex="-1"></a>Then the resistance raster should be down sampled and moved to the same location as the risk map.</span>
<span id="cb35-316"><a href="#cb35-316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-319"><a href="#cb35-319" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-320"><a href="#cb35-320" aria-hidden="true" tabindex="-1"></a><span class="do">## move the resistence 'rivers' to the same location as the risk map</span></span>
<span id="cb35-321"><a href="#cb35-321" aria-hidden="true" tabindex="-1"></a>resistance <span class="ot">&lt;-</span> <span class="fu">rast</span>(<span class="at">nrows =</span> <span class="fu">dim</span>(resistance)[<span class="dv">1</span>],</span>
<span id="cb35-322"><a href="#cb35-322" aria-hidden="true" tabindex="-1"></a>                   <span class="at">ncols =</span> <span class="fu">dim</span>(resistance)[<span class="dv">2</span>],</span>
<span id="cb35-323"><a href="#cb35-323" aria-hidden="true" tabindex="-1"></a>                   <span class="at">nlyrs =</span> <span class="dv">1</span>, </span>
<span id="cb35-324"><a href="#cb35-324" aria-hidden="true" tabindex="-1"></a>                   <span class="at">names =</span> <span class="st">"resistance"</span>, </span>
<span id="cb35-325"><a href="#cb35-325" aria-hidden="true" tabindex="-1"></a>                   <span class="at">extent =</span> <span class="fu">st_bbox</span>(aoi),</span>
<span id="cb35-326"><a href="#cb35-326" aria-hidden="true" tabindex="-1"></a>                   <span class="at">vals =</span> <span class="fu">values</span>(resistance),</span>
<span id="cb35-327"><a href="#cb35-327" aria-hidden="true" tabindex="-1"></a>                   <span class="at">crs =</span> <span class="fu">crs</span>(riskmap))</span>
<span id="cb35-328"><a href="#cb35-328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-329"><a href="#cb35-329" aria-hidden="true" tabindex="-1"></a><span class="do">## resample to resolution matches riskmap</span></span>
<span id="cb35-330"><a href="#cb35-330" aria-hidden="true" tabindex="-1"></a>resistance <span class="ot">&lt;-</span> <span class="fu">resample</span>(resistance, riskmap, <span class="at">method =</span> <span class="st">"rms"</span>)</span>
<span id="cb35-331"><a href="#cb35-331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-332"><a href="#cb35-332" aria-hidden="true" tabindex="-1"></a><span class="do">## make NAs to 1</span></span>
<span id="cb35-333"><a href="#cb35-333" aria-hidden="true" tabindex="-1"></a>resistance[<span class="fu">is.na</span>(resistance)] <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb35-334"><a href="#cb35-334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-335"><a href="#cb35-335" aria-hidden="true" tabindex="-1"></a><span class="do">## plot it</span></span>
<span id="cb35-336"><a href="#cb35-336" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb35-337"><a href="#cb35-337" aria-hidden="true" tabindex="-1"></a>  stars<span class="sc">::</span><span class="fu">geom_stars</span>(<span class="at">data =</span> stars<span class="sc">::</span><span class="fu">st_as_stars</span>(resistance)) <span class="sc">+</span></span>
<span id="cb35-338"><a href="#cb35-338" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_steps</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.001</span>, <span class="fl">0.4</span>, <span class="fl">0.6</span>, <span class="fl">0.75</span>, <span class="dv">1</span>),</span>
<span id="cb35-339"><a href="#cb35-339" aria-hidden="true" tabindex="-1"></a>                   <span class="at">low=</span><span class="st">"white"</span>, <span class="at">high =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb35-340"><a href="#cb35-340" aria-hidden="true" tabindex="-1"></a>  <span class="co"># scale_fill_viridis_c(option = "H") +</span></span>
<span id="cb35-341"><a href="#cb35-341" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_fixed</span>() <span class="sc">+</span></span>
<span id="cb35-342"><a href="#cb35-342" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="cn">NULL</span>, <span class="at">y=</span><span class="cn">NULL</span>, <span class="at">fill =</span> <span class="st">"resistance"</span>, <span class="at">title =</span> <span class="st">"Resistance layer"</span>) <span class="sc">+</span></span>
<span id="cb35-343"><a href="#cb35-343" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text =</span> <span class="fu">element_blank</span>()) <span class="co"># since don't care about location</span></span>
<span id="cb35-344"><a href="#cb35-344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-345"><a href="#cb35-345" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-346"><a href="#cb35-346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-347"><a href="#cb35-347" aria-hidden="true" tabindex="-1"></a>At first I tried using the same random starting locations as above to generate my correlated walks for each individual.</span>
<span id="cb35-348"><a href="#cb35-348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-351"><a href="#cb35-351" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-352"><a href="#cb35-352" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb35-353"><a href="#cb35-353" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb35-354"><a href="#cb35-354" aria-hidden="true" tabindex="-1"></a><span class="do">## simulate single state walks of 1000 steps</span></span>
<span id="cb35-355"><a href="#cb35-355" aria-hidden="true" tabindex="-1"></a>sim.rw <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb35-356"><a href="#cb35-356" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>) {</span>
<span id="cb35-357"><a href="#cb35-357" aria-hidden="true" tabindex="-1"></a>  <span class="do">## simulate from location i</span></span>
<span id="cb35-358"><a href="#cb35-358" aria-hidden="true" tabindex="-1"></a>  tmp <span class="ot">&lt;-</span> <span class="fu">simulate</span>(levy.walker, nsteps,</span>
<span id="cb35-359"><a href="#cb35-359" aria-hidden="true" tabindex="-1"></a>                  <span class="at">resist =</span> <span class="fu">raster</span>(resistance),</span>
<span id="cb35-360"><a href="#cb35-360" aria-hidden="true" tabindex="-1"></a>                   <span class="at">coords =</span> start_coord_mat[i,])</span>
<span id="cb35-361"><a href="#cb35-361" aria-hidden="true" tabindex="-1"></a>  <span class="do">## save results to a list</span></span>
<span id="cb35-362"><a href="#cb35-362" aria-hidden="true" tabindex="-1"></a>  sim.rw[[i]] <span class="ot">&lt;-</span> <span class="fu">cbind</span>(tmp[,<span class="dv">1</span>], tmp[,<span class="dv">2</span>])</span>
<span id="cb35-363"><a href="#cb35-363" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb35-364"><a href="#cb35-364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-365"><a href="#cb35-365" aria-hidden="true" tabindex="-1"></a><span class="do">## make in to sfc lines</span></span>
<span id="cb35-366"><a href="#cb35-366" aria-hidden="true" tabindex="-1"></a>sim.rw.bad <span class="ot">&lt;-</span> <span class="fu">lapply</span>(sim.rw, st_linestring)</span>
<span id="cb35-367"><a href="#cb35-367" aria-hidden="true" tabindex="-1"></a>sim.rw.bad <span class="ot">&lt;-</span> <span class="fu">st_sf</span>(<span class="at">id =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>, <span class="at">geometry =</span> sim.rw.bad) <span class="sc">%&gt;%</span> </span>
<span id="cb35-368"><a href="#cb35-368" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_set_crs</span>(<span class="fu">st_crs</span>(riskmap))</span>
<span id="cb35-369"><a href="#cb35-369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-370"><a href="#cb35-370" aria-hidden="true" tabindex="-1"></a><span class="do">## plot it</span></span>
<span id="cb35-371"><a href="#cb35-371" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb35-372"><a href="#cb35-372" aria-hidden="true" tabindex="-1"></a>  stars<span class="sc">::</span><span class="fu">geom_stars</span>(<span class="at">data =</span> stars<span class="sc">::</span><span class="fu">st_as_stars</span>(resistance)) <span class="sc">+</span></span>
<span id="cb35-373"><a href="#cb35-373" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_steps</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.001</span>, <span class="fl">0.4</span>, <span class="fl">0.6</span>, <span class="fl">0.75</span>, <span class="dv">1</span>),</span>
<span id="cb35-374"><a href="#cb35-374" aria-hidden="true" tabindex="-1"></a>                   <span class="at">low=</span><span class="st">"white"</span>, <span class="at">high =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb35-375"><a href="#cb35-375" aria-hidden="true" tabindex="-1"></a>  <span class="co"># scale_fill_viridis_c(option = "H") +</span></span>
<span id="cb35-376"><a href="#cb35-376" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_fixed</span>() <span class="sc">+</span></span>
<span id="cb35-377"><a href="#cb35-377" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="cn">NULL</span>, <span class="at">y=</span><span class="cn">NULL</span>, <span class="at">fill =</span> <span class="st">"resistance"</span>, <span class="at">title =</span> <span class="st">"Levy-walker walks - random start locations"</span>) <span class="sc">+</span></span>
<span id="cb35-378"><a href="#cb35-378" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span><span class="co"># since don't care about location</span></span>
<span id="cb35-379"><a href="#cb35-379" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> sim.rw.bad, <span class="at">col=</span><span class="st">"red"</span>, <span class="at">alpha=</span><span class="fl">0.5</span>)</span>
<span id="cb35-380"><a href="#cb35-380" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-381"><a href="#cb35-381" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-384"><a href="#cb35-384" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-385"><a href="#cb35-385" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false</span></span>
<span id="cb35-386"><a href="#cb35-386" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(sim.rw, tmp, sim.rw.bad, start_coord_mat)</span>
<span id="cb35-387"><a href="#cb35-387" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-388"><a href="#cb35-388" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-389"><a href="#cb35-389" aria-hidden="true" tabindex="-1"></a>However, to make this more realistic, my correlated walks should also act like individuals following paths then delving off into different areas such as people accessing their crop fields. So instead of using random starting locations, I made the starting locations only be in low resistance areas.</span>
<span id="cb35-390"><a href="#cb35-390" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-393"><a href="#cb35-393" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-394"><a href="#cb35-394" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb35-395"><a href="#cb35-395" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb35-396"><a href="#cb35-396" aria-hidden="true" tabindex="-1"></a><span class="do">## new starting coords in areas of low resistance so don't get stuck</span></span>
<span id="cb35-397"><a href="#cb35-397" aria-hidden="true" tabindex="-1"></a>init <span class="ot">=</span> <span class="fu">xyFromCell</span>(resistance, <span class="fu">sample</span>(<span class="fu">which</span>(<span class="fu">values</span>(resistance) <span class="sc">==</span> <span class="dv">0</span>), <span class="dv">100</span>, <span class="at">replace=</span>T))</span>
<span id="cb35-398"><a href="#cb35-398" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-399"><a href="#cb35-399" aria-hidden="true" tabindex="-1"></a><span class="do">## simulate</span></span>
<span id="cb35-400"><a href="#cb35-400" aria-hidden="true" tabindex="-1"></a>sim.rw <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb35-401"><a href="#cb35-401" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>) {</span>
<span id="cb35-402"><a href="#cb35-402" aria-hidden="true" tabindex="-1"></a>  <span class="do">## simulate from location i</span></span>
<span id="cb35-403"><a href="#cb35-403" aria-hidden="true" tabindex="-1"></a>  tmp <span class="ot">&lt;-</span> <span class="fu">simulate</span>(levy.walker, nsteps,</span>
<span id="cb35-404"><a href="#cb35-404" aria-hidden="true" tabindex="-1"></a>                  <span class="at">resist =</span> <span class="fu">raster</span>(resistance),</span>
<span id="cb35-405"><a href="#cb35-405" aria-hidden="true" tabindex="-1"></a>                   <span class="at">coords =</span> init[i,])</span>
<span id="cb35-406"><a href="#cb35-406" aria-hidden="true" tabindex="-1"></a>  <span class="do">## save results to a list</span></span>
<span id="cb35-407"><a href="#cb35-407" aria-hidden="true" tabindex="-1"></a>  sim.rw[[i]] <span class="ot">&lt;-</span> <span class="fu">cbind</span>(tmp[,<span class="dv">1</span>], tmp[,<span class="dv">2</span>])</span>
<span id="cb35-408"><a href="#cb35-408" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb35-409"><a href="#cb35-409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-410"><a href="#cb35-410" aria-hidden="true" tabindex="-1"></a><span class="do">## make in to sfc lines</span></span>
<span id="cb35-411"><a href="#cb35-411" aria-hidden="true" tabindex="-1"></a>sim.rw.levy <span class="ot">&lt;-</span> <span class="fu">lapply</span>(sim.rw, st_linestring)</span>
<span id="cb35-412"><a href="#cb35-412" aria-hidden="true" tabindex="-1"></a>sim.rw.levy <span class="ot">&lt;-</span> <span class="fu">st_sf</span>(<span class="at">id =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>, <span class="at">geometry =</span> sim.rw.levy) <span class="sc">%&gt;%</span> </span>
<span id="cb35-413"><a href="#cb35-413" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_set_crs</span>(<span class="fu">st_crs</span>(riskmap))</span>
<span id="cb35-414"><a href="#cb35-414" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-415"><a href="#cb35-415" aria-hidden="true" tabindex="-1"></a><span class="do">## plot it</span></span>
<span id="cb35-416"><a href="#cb35-416" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb35-417"><a href="#cb35-417" aria-hidden="true" tabindex="-1"></a>  stars<span class="sc">::</span><span class="fu">geom_stars</span>(<span class="at">data =</span> stars<span class="sc">::</span><span class="fu">st_as_stars</span>(resistance)) <span class="sc">+</span></span>
<span id="cb35-418"><a href="#cb35-418" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_steps</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.001</span>, <span class="fl">0.4</span>, <span class="fl">0.6</span>, <span class="fl">0.75</span>, <span class="dv">1</span>),</span>
<span id="cb35-419"><a href="#cb35-419" aria-hidden="true" tabindex="-1"></a>                   <span class="at">low=</span><span class="st">"white"</span>, <span class="at">high =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb35-420"><a href="#cb35-420" aria-hidden="true" tabindex="-1"></a>  <span class="co"># scale_fill_viridis_c(option = "H") +</span></span>
<span id="cb35-421"><a href="#cb35-421" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_fixed</span>() <span class="sc">+</span></span>
<span id="cb35-422"><a href="#cb35-422" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="cn">NULL</span>, <span class="at">y=</span><span class="cn">NULL</span>, <span class="at">fill =</span> <span class="st">"resistance"</span>, <span class="at">title =</span> <span class="st">"Levy-walker walks"</span>) <span class="sc">+</span></span>
<span id="cb35-423"><a href="#cb35-423" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span><span class="co"># since don't care about location</span></span>
<span id="cb35-424"><a href="#cb35-424" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> sim.rw.levy, <span class="at">col=</span><span class="st">"red"</span>, <span class="at">alpha=</span><span class="fl">0.25</span>)</span>
<span id="cb35-425"><a href="#cb35-425" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-426"><a href="#cb35-426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-429"><a href="#cb35-429" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-430"><a href="#cb35-430" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false</span></span>
<span id="cb35-431"><a href="#cb35-431" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(sim.rw, tmp, init)</span>
<span id="cb35-432"><a href="#cb35-432" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-433"><a href="#cb35-433" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-434"><a href="#cb35-434" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exposure risk</span></span>
<span id="cb35-435"><a href="#cb35-435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-436"><a href="#cb35-436" aria-hidden="true" tabindex="-1"></a>For each individual I calculate their utilization distribution based purely on the proportion of points in each cell (density). For real movement data using more accurate estimates of utilization distributions such as kernel density, Brownian bridge movement models, etc. However, those methods are slow.</span>
<span id="cb35-437"><a href="#cb35-437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-438"><a href="#cb35-438" aria-hidden="true" tabindex="-1"></a>To figure out how to do this, I first tried it out with just one individual.</span>
<span id="cb35-439"><a href="#cb35-439" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-442"><a href="#cb35-442" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-443"><a href="#cb35-443" aria-hidden="true" tabindex="-1"></a><span class="do">## which individual (1-100)</span></span>
<span id="cb35-444"><a href="#cb35-444" aria-hidden="true" tabindex="-1"></a>who <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb35-445"><a href="#cb35-445" aria-hidden="true" tabindex="-1"></a><span class="do">## kernel density estimate</span></span>
<span id="cb35-446"><a href="#cb35-446" aria-hidden="true" tabindex="-1"></a>kde.trial <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rasterize</span>(<span class="fu">st_cast</span>(sim.rw.levy[who,], <span class="st">"MULTIPOINT"</span>), riskmap, <span class="at">fun =</span> <span class="st">"length"</span>, <span class="at">background =</span> <span class="dv">0</span>)<span class="sc">/</span>nsteps</span>
<span id="cb35-447"><a href="#cb35-447" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-448"><a href="#cb35-448" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">sum</span>(<span class="fu">values</span>(kde.trial), <span class="at">na.rm=</span>T) <span class="sc">!=</span> <span class="dv">1</span>){</span>
<span id="cb35-449"><a href="#cb35-449" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stop</span>(<span class="st">"the sum of the density should be equal to 1"</span>)</span>
<span id="cb35-450"><a href="#cb35-450" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb35-451"><a href="#cb35-451" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-452"><a href="#cb35-452" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-453"><a href="#cb35-453" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, include=F, eval=FALSE}</span></span>
<span id="cb35-454"><a href="#cb35-454" aria-hidden="true" tabindex="-1"></a><span class="do">### this is resulting in kde map that doesn't align with the track</span></span>
<span id="cb35-455"><a href="#cb35-455" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-456"><a href="#cb35-456" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-457"><a href="#cb35-457" aria-hidden="true" tabindex="-1"></a><span class="do">## need a list of the coordinates for one individual</span></span>
<span id="cb35-458"><a href="#cb35-458" aria-hidden="true" tabindex="-1"></a>kde.trial <span class="ot">&lt;-</span> sim.rw.levy[<span class="dv">1</span>,] <span class="sc">%&gt;%</span> </span>
<span id="cb35-459"><a href="#cb35-459" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_coordinates</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb35-460"><a href="#cb35-460" aria-hidden="true" tabindex="-1"></a>  as.data.frame</span>
<span id="cb35-461"><a href="#cb35-461" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-462"><a href="#cb35-462" aria-hidden="true" tabindex="-1"></a><span class="do">### use mass kde function</span></span>
<span id="cb35-463"><a href="#cb35-463" aria-hidden="true" tabindex="-1"></a>kde.trial <span class="ot">&lt;-</span> MASS<span class="sc">::</span><span class="fu">kde2d</span>(<span class="at">x =</span> kde.trial<span class="sc">$</span>X, </span>
<span id="cb35-464"><a href="#cb35-464" aria-hidden="true" tabindex="-1"></a>                         <span class="at">y =</span> kde.trial<span class="sc">$</span>Y)<span class="co">#,</span></span>
<span id="cb35-465"><a href="#cb35-465" aria-hidden="true" tabindex="-1"></a>                         <span class="co"># n=c(ncol(riskmap),</span></span>
<span id="cb35-466"><a href="#cb35-466" aria-hidden="true" tabindex="-1"></a>                             <span class="co"># nrow(riskmap)))#, lims = ext(riskmap)[1:4])</span></span>
<span id="cb35-467"><a href="#cb35-467" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-468"><a href="#cb35-468" aria-hidden="true" tabindex="-1"></a><span class="do">## make back into rast</span></span>
<span id="cb35-469"><a href="#cb35-469" aria-hidden="true" tabindex="-1"></a>kde.trial <span class="ot">&lt;-</span> <span class="fu">rast</span>(kde.trial<span class="sc">$</span>z,</span>
<span id="cb35-470"><a href="#cb35-470" aria-hidden="true" tabindex="-1"></a>                  <span class="at">crs =</span> <span class="fu">crs</span>(riskmap),</span>
<span id="cb35-471"><a href="#cb35-471" aria-hidden="true" tabindex="-1"></a>                  <span class="at">extent =</span> <span class="fu">ext</span>(riskmap))</span>
<span id="cb35-472"><a href="#cb35-472" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-473"><a href="#cb35-473" aria-hidden="true" tabindex="-1"></a><span class="do">## plot</span></span>
<span id="cb35-474"><a href="#cb35-474" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb35-475"><a href="#cb35-475" aria-hidden="true" tabindex="-1"></a>  stars<span class="sc">::</span><span class="fu">geom_stars</span>(<span class="at">data =</span> stars<span class="sc">::</span><span class="fu">st_as_stars</span>(kde.trial)) <span class="sc">+</span></span>
<span id="cb35-476"><a href="#cb35-476" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">option =</span> <span class="st">"D"</span>) <span class="sc">+</span></span>
<span id="cb35-477"><a href="#cb35-477" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_fixed</span>() <span class="sc">+</span></span>
<span id="cb35-478"><a href="#cb35-478" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="cn">NULL</span>, <span class="at">y=</span><span class="cn">NULL</span>, <span class="at">fill =</span> <span class="st">"kde"</span>, <span class="at">title =</span> <span class="st">"Density estimate for one individual"</span>) <span class="sc">+</span></span>
<span id="cb35-479"><a href="#cb35-479" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span><span class="co"># since don't care about location</span></span>
<span id="cb35-480"><a href="#cb35-480" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> sim.rw.levy[<span class="dv">1</span>,])</span>
<span id="cb35-481"><a href="#cb35-481" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-482"><a href="#cb35-482" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-483"><a href="#cb35-483" aria-hidden="true" tabindex="-1"></a>To see what that looks like, for the single individual I cropped to just the immediate area that individual used the plot their density estimate.</span>
<span id="cb35-484"><a href="#cb35-484" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-487"><a href="#cb35-487" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-488"><a href="#cb35-488" aria-hidden="true" tabindex="-1"></a><span class="do">## crop to area where the individual was so not tiny</span></span>
<span id="cb35-489"><a href="#cb35-489" aria-hidden="true" tabindex="-1"></a>kde.sm <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">crop</span>(kde.trial, <span class="fu">st_buffer</span>(sim.rw.levy[who,], <span class="dv">2000</span>))</span>
<span id="cb35-490"><a href="#cb35-490" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-491"><a href="#cb35-491" aria-hidden="true" tabindex="-1"></a><span class="do">## similarly crop riskmap to same area</span></span>
<span id="cb35-492"><a href="#cb35-492" aria-hidden="true" tabindex="-1"></a>risk.sm <span class="ot">&lt;-</span> <span class="fu">crop</span>(riskmap, <span class="fu">st_buffer</span>(sim.rw.levy[who,], <span class="dv">2000</span>))</span>
<span id="cb35-493"><a href="#cb35-493" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-494"><a href="#cb35-494" aria-hidden="true" tabindex="-1"></a><span class="do">## plot traj and kde</span></span>
<span id="cb35-495"><a href="#cb35-495" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb35-496"><a href="#cb35-496" aria-hidden="true" tabindex="-1"></a>  stars<span class="sc">::</span><span class="fu">geom_stars</span>(<span class="at">data =</span> stars<span class="sc">::</span><span class="fu">st_as_stars</span>(kde.sm)) <span class="sc">+</span></span>
<span id="cb35-497"><a href="#cb35-497" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">option=</span><span class="st">"A"</span>, <span class="at">direction =</span> <span class="sc">-</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb35-498"><a href="#cb35-498" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_fixed</span>() <span class="sc">+</span></span>
<span id="cb35-499"><a href="#cb35-499" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="cn">NULL</span>, <span class="at">y=</span><span class="cn">NULL</span>, <span class="at">fill =</span> <span class="st">"kde"</span>, <span class="at">title =</span> <span class="st">"Density raster of one individual"</span>) <span class="sc">+</span></span>
<span id="cb35-500"><a href="#cb35-500" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span><span class="co"># since don't care about location</span></span>
<span id="cb35-501"><a href="#cb35-501" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> sim.rw.levy[who,])</span>
<span id="cb35-502"><a href="#cb35-502" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-503"><a href="#cb35-503" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-504"><a href="#cb35-504" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-505"><a href="#cb35-505" aria-hidden="true" tabindex="-1"></a>Now I want to calculate the exposure risk for each individual $k$ in each pixel ($i$) as a function of the time they spend in that pixel and the risk of exposure in that pixel.</span>
<span id="cb35-506"><a href="#cb35-506" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-507"><a href="#cb35-507" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb35-508"><a href="#cb35-508" aria-hidden="true" tabindex="-1"></a>Exposure_{ki} = kde_i*risk_i</span>
<span id="cb35-509"><a href="#cb35-509" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb35-510"><a href="#cb35-510" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-513"><a href="#cb35-513" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-514"><a href="#cb35-514" aria-hidden="true" tabindex="-1"></a><span class="do">## calculate risk </span></span>
<span id="cb35-515"><a href="#cb35-515" aria-hidden="true" tabindex="-1"></a>kde.risk <span class="ot">&lt;-</span> kde.sm<span class="sc">*</span>risk.sm</span>
<span id="cb35-516"><a href="#cb35-516" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-517"><a href="#cb35-517" aria-hidden="true" tabindex="-1"></a><span class="do">## plots to demo</span></span>
<span id="cb35-518"><a href="#cb35-518" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb35-519"><a href="#cb35-519" aria-hidden="true" tabindex="-1"></a>  tidyterra<span class="sc">::</span><span class="fu">geom_spatraster</span>(<span class="at">data=</span>risk.sm) <span class="sc">+</span></span>
<span id="cb35-520"><a href="#cb35-520" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">option=</span><span class="st">"A"</span>, <span class="at">direction =</span> <span class="sc">-</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb35-521"><a href="#cb35-521" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Landscape risk"</span>, <span class="at">fill =</span> <span class="st">"risk"</span>) <span class="sc">+</span></span>
<span id="cb35-522"><a href="#cb35-522" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>, <span class="at">axis.text =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb35-523"><a href="#cb35-523" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.direction =</span> <span class="st">"horizontal"</span>)</span>
<span id="cb35-524"><a href="#cb35-524" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb35-525"><a href="#cb35-525" aria-hidden="true" tabindex="-1"></a>  tidyterra<span class="sc">::</span><span class="fu">geom_spatraster</span>(<span class="at">data=</span>kde.sm) <span class="sc">+</span></span>
<span id="cb35-526"><a href="#cb35-526" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">option=</span><span class="st">"A"</span>, <span class="at">direction =</span> <span class="sc">-</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb35-527"><a href="#cb35-527" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"KDE of Individual use"</span>, <span class="at">fill =</span> <span class="st">"use"</span>) <span class="sc">+</span></span>
<span id="cb35-528"><a href="#cb35-528" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>, <span class="at">axis.text =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb35-529"><a href="#cb35-529" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.direction =</span> <span class="st">"horizontal"</span>)</span>
<span id="cb35-530"><a href="#cb35-530" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb35-531"><a href="#cb35-531" aria-hidden="true" tabindex="-1"></a>  tidyterra<span class="sc">::</span><span class="fu">geom_spatraster</span>(<span class="at">data=</span>kde.risk) <span class="sc">+</span></span>
<span id="cb35-532"><a href="#cb35-532" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">option=</span><span class="st">"A"</span>, <span class="at">direction =</span> <span class="sc">-</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb35-533"><a href="#cb35-533" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Infection probability"</span>, <span class="at">fill =</span> <span class="st">"probability"</span>) <span class="sc">+</span></span>
<span id="cb35-534"><a href="#cb35-534" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>, <span class="at">axis.text =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb35-535"><a href="#cb35-535" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.direction =</span> <span class="st">"horizontal"</span>)</span>
<span id="cb35-536"><a href="#cb35-536" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2 <span class="sc">+</span> p3</span>
<span id="cb35-537"><a href="#cb35-537" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-538"><a href="#cb35-538" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-541"><a href="#cb35-541" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-542"><a href="#cb35-542" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false</span></span>
<span id="cb35-543"><a href="#cb35-543" aria-hidden="true" tabindex="-1"></a><span class="do">#### clean up examples</span></span>
<span id="cb35-544"><a href="#cb35-544" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(kde.sm, risk.sm, kde.risk, p1, p2, p3, who)</span>
<span id="cb35-545"><a href="#cb35-545" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-546"><a href="#cb35-546" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-547"><a href="#cb35-547" aria-hidden="true" tabindex="-1"></a>Therefore for each individual $k$ their cumulative 'exposure risk' the sum of all their exposures in pixels, where $i$ is $1:n_{pixels}$: $$</span>
<span id="cb35-548"><a href="#cb35-548" aria-hidden="true" tabindex="-1"></a>Exposure_k = \sum{kde_i*risk_i}</span>
<span id="cb35-549"><a href="#cb35-549" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb35-550"><a href="#cb35-550" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-551"><a href="#cb35-551" aria-hidden="true" tabindex="-1"></a>To calculate the cummulative exposure risk for all individuals, I used a function.</span>
<span id="cb35-552"><a href="#cb35-552" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-555"><a href="#cb35-555" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-556"><a href="#cb35-556" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: show</span></span>
<span id="cb35-557"><a href="#cb35-557" aria-hidden="true" tabindex="-1"></a><span class="do">## make a function</span></span>
<span id="cb35-558"><a href="#cb35-558" aria-hidden="true" tabindex="-1"></a>measure_risk <span class="ot">&lt;-</span> <span class="cf">function</span>(walker, riskmap, nsteps){</span>
<span id="cb35-559"><a href="#cb35-559" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb35-560"><a href="#cb35-560" aria-hidden="true" tabindex="-1"></a>  <span class="do">## convert from lines to points</span></span>
<span id="cb35-561"><a href="#cb35-561" aria-hidden="true" tabindex="-1"></a>  pts <span class="ot">&lt;-</span> <span class="fu">st_cast</span>(walker, <span class="st">"MULTIPOINT"</span>)</span>
<span id="cb35-562"><a href="#cb35-562" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb35-563"><a href="#cb35-563" aria-hidden="true" tabindex="-1"></a>  <span class="do">## dataframe with any attributes (just IDs)</span></span>
<span id="cb35-564"><a href="#cb35-564" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> pts <span class="sc">%&gt;%</span> <span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span> <span class="fu">as.data.frame</span>()</span>
<span id="cb35-565"><a href="#cb35-565" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb35-566"><a href="#cb35-566" aria-hidden="true" tabindex="-1"></a>  pts <span class="ot">&lt;-</span> <span class="fu">vect</span>(pts)</span>
<span id="cb35-567"><a href="#cb35-567" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-568"><a href="#cb35-568" aria-hidden="true" tabindex="-1"></a>  <span class="do">## for each individual rasterize their points so have sum of points in each pixel</span></span>
<span id="cb35-569"><a href="#cb35-569" aria-hidden="true" tabindex="-1"></a>  <span class="do">## this is not working using the stars::st_rasterize, or the terra::rasterize -- both return one object of all individuals, not an obj per indiv</span></span>
<span id="cb35-570"><a href="#cb35-570" aria-hidden="true" tabindex="-1"></a>  <span class="do">## also tried using apply, lapp, and app with those terra::rasterize</span></span>
<span id="cb35-571"><a href="#cb35-571" aria-hidden="true" tabindex="-1"></a>  kde <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb35-572"><a href="#cb35-572" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(pts)){</span>
<span id="cb35-573"><a href="#cb35-573" aria-hidden="true" tabindex="-1"></a>    kde[[i]] <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rasterize</span>(pts[i,], riskmap, <span class="at">fun =</span> <span class="st">"length"</span>, <span class="at">background =</span> <span class="dv">0</span>)<span class="sc">/</span>nsteps</span>
<span id="cb35-574"><a href="#cb35-574" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb35-575"><a href="#cb35-575" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-576"><a href="#cb35-576" aria-hidden="true" tabindex="-1"></a>  <span class="do">## multiply time in cell (kde) * cell's risk</span></span>
<span id="cb35-577"><a href="#cb35-577" aria-hidden="true" tabindex="-1"></a>  kde.risk <span class="ot">&lt;-</span> <span class="fu">lapply</span>(kde, <span class="cf">function</span>(i) i<span class="sc">*</span>riskmap)</span>
<span id="cb35-578"><a href="#cb35-578" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb35-579"><a href="#cb35-579" aria-hidden="true" tabindex="-1"></a>  <span class="do">## sum of values in each layer are individual's risk</span></span>
<span id="cb35-580"><a href="#cb35-580" aria-hidden="true" tabindex="-1"></a>  indiv.risk <span class="ot">&lt;-</span> <span class="fu">lapply</span>(kde.risk, <span class="cf">function</span>(i) <span class="fu">sum</span>(<span class="fu">values</span>(i), <span class="at">na.rm=</span>T))</span>
<span id="cb35-581"><a href="#cb35-581" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb35-582"><a href="#cb35-582" aria-hidden="true" tabindex="-1"></a>  df<span class="sc">$</span>exp_risk <span class="ot">&lt;-</span> <span class="fu">unlist</span>(indiv.risk)</span>
<span id="cb35-583"><a href="#cb35-583" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb35-584"><a href="#cb35-584" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(df)</span>
<span id="cb35-585"><a href="#cb35-585" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb35-586"><a href="#cb35-586" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-587"><a href="#cb35-587" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-588"><a href="#cb35-588" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-589"><a href="#cb35-589" aria-hidden="true" tabindex="-1"></a>I found the cummulative expsoure risk for each individual using the function.</span>
<span id="cb35-590"><a href="#cb35-590" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-593"><a href="#cb35-593" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-594"><a href="#cb35-594" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb35-595"><a href="#cb35-595" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb35-596"><a href="#cb35-596" aria-hidden="true" tabindex="-1"></a><span class="do">## calculate individual risk for the brownian (1) and correlated (2)</span></span>
<span id="cb35-597"><a href="#cb35-597" aria-hidden="true" tabindex="-1"></a>indiv.risk.rw <span class="ot">&lt;-</span> <span class="fu">measure_risk</span>(<span class="at">walker =</span> sim.rw.sfc, <span class="at">riskmap =</span> riskmap, <span class="at">nsteps =</span> nsteps)</span>
<span id="cb35-598"><a href="#cb35-598" aria-hidden="true" tabindex="-1"></a>indiv.risk.levy <span class="ot">&lt;-</span> <span class="fu">measure_risk</span>(<span class="at">walker =</span> sim.rw.levy, <span class="at">riskmap =</span> riskmap, <span class="at">nsteps =</span> nsteps)</span>
<span id="cb35-599"><a href="#cb35-599" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-600"><a href="#cb35-600" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-601"><a href="#cb35-601" aria-hidden="true" tabindex="-1"></a>The distribution of values in the random walkers is the range of the map, which is expected.</span>
<span id="cb35-602"><a href="#cb35-602" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-605"><a href="#cb35-605" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-606"><a href="#cb35-606" aria-hidden="true" tabindex="-1"></a><span class="do">## look at some of the values</span></span>
<span id="cb35-607"><a href="#cb35-607" aria-hidden="true" tabindex="-1"></a><span class="co"># indiv.risk.rw %&gt;% head() %&gt;% knitr::kable(title = "Cummulative exposure risk (`exp_risk`) by individual (`id`)")</span></span>
<span id="cb35-608"><a href="#cb35-608" aria-hidden="true" tabindex="-1"></a>indiv.risk.rw <span class="sc">%&gt;%</span> </span>
<span id="cb35-609"><a href="#cb35-609" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb35-610"><a href="#cb35-610" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">x =</span> exp_risk)) <span class="sc">+</span></span>
<span id="cb35-611"><a href="#cb35-611" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"risk"</span>, <span class="at">title =</span> <span class="st">"Distribution of individual's cumulative exposure risk - Random walks"</span>)</span>
<span id="cb35-612"><a href="#cb35-612" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-613"><a href="#cb35-613" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-614"><a href="#cb35-614" aria-hidden="true" tabindex="-1"></a>The distribution of values in the correlated walkers is less then the range of the map, which is also expected.</span>
<span id="cb35-615"><a href="#cb35-615" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-618"><a href="#cb35-618" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-619"><a href="#cb35-619" aria-hidden="true" tabindex="-1"></a><span class="co"># indiv.risk.levy %&gt;% head()</span></span>
<span id="cb35-620"><a href="#cb35-620" aria-hidden="true" tabindex="-1"></a>indiv.risk.levy <span class="sc">%&gt;%</span> </span>
<span id="cb35-621"><a href="#cb35-621" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb35-622"><a href="#cb35-622" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">x =</span> exp_risk)) <span class="sc">+</span></span>
<span id="cb35-623"><a href="#cb35-623" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"risk"</span>, <span class="at">title =</span> <span class="st">"Distribution of individual's cumulative exposure risk - Levy-walker walks"</span>)</span>
<span id="cb35-624"><a href="#cb35-624" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-625"><a href="#cb35-625" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-626"><a href="#cb35-626" aria-hidden="true" tabindex="-1"></a><span class="fu">## Assisgn susceptibility</span></span>
<span id="cb35-627"><a href="#cb35-627" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-628"><a href="#cb35-628" aria-hidden="true" tabindex="-1"></a>Individuals should have variable susceptibility so that not everyone's probability of infection equals their risk sum. This is adding noise to the data. I want to compare the randomly assign susceptibility to a fixed susceptibility for each simulation. The fixed susceptibility is just the average susceptibility of all individuals in that round of the simulation. For this simulation I am assigning susceptibility randomly using a uniform distribution between 0.7 and 0.9. and the fixed susceptibility with the average of the random susceptibility values.</span>
<span id="cb35-629"><a href="#cb35-629" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-632"><a href="#cb35-632" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-633"><a href="#cb35-633" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: show</span></span>
<span id="cb35-634"><a href="#cb35-634" aria-hidden="true" tabindex="-1"></a><span class="do">## susceptibility is variable between individuals</span></span>
<span id="cb35-635"><a href="#cb35-635" aria-hidden="true" tabindex="-1"></a>susceptibility <span class="ot">=</span> <span class="fu">runif</span>(<span class="dv">100</span>, <span class="fl">0.7</span>, <span class="fl">0.9</span>)</span>
<span id="cb35-636"><a href="#cb35-636" aria-hidden="true" tabindex="-1"></a>mean_suscept <span class="ot">=</span> <span class="fu">mean</span>(susceptibility)</span>
<span id="cb35-637"><a href="#cb35-637" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-638"><a href="#cb35-638" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-639"><a href="#cb35-639" aria-hidden="true" tabindex="-1"></a>The probability of infection is a product of the individuals exposure risk and susceptibility.</span>
<span id="cb35-640"><a href="#cb35-640" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-643"><a href="#cb35-643" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-644"><a href="#cb35-644" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: Infections in Random Walkers</span></span>
<span id="cb35-645"><a href="#cb35-645" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-subcap: ["exposure*susceptibility", "exposure*avg susceptbility"]</span></span>
<span id="cb35-646"><a href="#cb35-646" aria-hidden="true" tabindex="-1"></a><span class="co">#| layout-ncol: 2</span></span>
<span id="cb35-647"><a href="#cb35-647" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-648"><a href="#cb35-648" aria-hidden="true" tabindex="-1"></a><span class="do">## make a dataframe for the outcomes --- random walkers</span></span>
<span id="cb35-649"><a href="#cb35-649" aria-hidden="true" tabindex="-1"></a>rw_risk <span class="ot">&lt;-</span> <span class="fu">cbind</span>(indiv.risk.rw,</span>
<span id="cb35-650"><a href="#cb35-650" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">data.frame</span>( <span class="at">susceptibility =</span> susceptibility)) <span class="sc">%&gt;%</span></span>
<span id="cb35-651"><a href="#cb35-651" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb35-652"><a href="#cb35-652" aria-hidden="true" tabindex="-1"></a>  <span class="do">## predict infections based on exposure risk</span></span>
<span id="cb35-653"><a href="#cb35-653" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">infected_es =</span> <span class="fu">rbinom</span>(<span class="dv">1</span>, <span class="dv">1</span>, exp_risk <span class="sc">*</span> susceptibility ), <span class="co"># sum(exp_risk * susceptibility)</span></span>
<span id="cb35-654"><a href="#cb35-654" aria-hidden="true" tabindex="-1"></a>           <span class="at">infected_e =</span> <span class="fu">rbinom</span>(<span class="dv">1</span>, <span class="dv">1</span>, exp_risk <span class="sc">*</span> mean_suscept)) <span class="co"># sum(exposure risk) alone</span></span>
<span id="cb35-655"><a href="#cb35-655" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-656"><a href="#cb35-656" aria-hidden="true" tabindex="-1"></a><span class="do">## see how many people infected  = 1</span></span>
<span id="cb35-657"><a href="#cb35-657" aria-hidden="true" tabindex="-1"></a>rw_risk <span class="sc">%&gt;%</span> <span class="fu">count</span>(infected_es) <span class="sc">%&gt;%</span> knitr<span class="sc">::</span><span class="fu">kable</span>()</span>
<span id="cb35-658"><a href="#cb35-658" aria-hidden="true" tabindex="-1"></a>rw_risk <span class="sc">%&gt;%</span> <span class="fu">count</span>(infected_e) <span class="sc">%&gt;%</span> knitr<span class="sc">::</span><span class="fu">kable</span>()</span>
<span id="cb35-659"><a href="#cb35-659" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-660"><a href="#cb35-660" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-661"><a href="#cb35-661" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-664"><a href="#cb35-664" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-665"><a href="#cb35-665" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: Infections in Correlated Walkers</span></span>
<span id="cb35-666"><a href="#cb35-666" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-subcap: ["exposure*susceptibility", "exposure*avg susceptbility"]</span></span>
<span id="cb35-667"><a href="#cb35-667" aria-hidden="true" tabindex="-1"></a><span class="co">#| layout-ncol: 2</span></span>
<span id="cb35-668"><a href="#cb35-668" aria-hidden="true" tabindex="-1"></a><span class="co">#| </span></span>
<span id="cb35-669"><a href="#cb35-669" aria-hidden="true" tabindex="-1"></a><span class="do">## make a dataframe for the outcomes --- levy walkers</span></span>
<span id="cb35-670"><a href="#cb35-670" aria-hidden="true" tabindex="-1"></a>levy_risk <span class="ot">&lt;-</span> <span class="fu">cbind</span>(indiv.risk.levy,</span>
<span id="cb35-671"><a href="#cb35-671" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">data.frame</span>( <span class="at">susceptibility =</span> susceptibility)) <span class="sc">%&gt;%</span></span>
<span id="cb35-672"><a href="#cb35-672" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb35-673"><a href="#cb35-673" aria-hidden="true" tabindex="-1"></a>  <span class="do">## predict infections based on exposure risk</span></span>
<span id="cb35-674"><a href="#cb35-674" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">infected_es =</span> <span class="fu">rbinom</span>(<span class="dv">1</span>, <span class="dv">1</span>, exp_risk <span class="sc">*</span> susceptibility ), <span class="co"># sum(exp_risk * susceptibility)</span></span>
<span id="cb35-675"><a href="#cb35-675" aria-hidden="true" tabindex="-1"></a>           <span class="at">infected_e =</span> <span class="fu">rbinom</span>(<span class="dv">1</span>, <span class="dv">1</span>, exp_risk <span class="sc">*</span> mean_suscept)) <span class="co"># sum(exposure risk) alone</span></span>
<span id="cb35-676"><a href="#cb35-676" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-677"><a href="#cb35-677" aria-hidden="true" tabindex="-1"></a><span class="do">## see how many people infected  = 1</span></span>
<span id="cb35-678"><a href="#cb35-678" aria-hidden="true" tabindex="-1"></a>levy_risk <span class="sc">%&gt;%</span> <span class="fu">count</span>(infected_es) <span class="sc">%&gt;%</span> knitr<span class="sc">::</span><span class="fu">kable</span>()</span>
<span id="cb35-679"><a href="#cb35-679" aria-hidden="true" tabindex="-1"></a>levy_risk <span class="sc">%&gt;%</span> <span class="fu">count</span>(infected_e) <span class="sc">%&gt;%</span> knitr<span class="sc">::</span><span class="fu">kable</span>()</span>
<span id="cb35-680"><a href="#cb35-680" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-681"><a href="#cb35-681" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-682"><a href="#cb35-682" aria-hidden="true" tabindex="-1"></a><span class="fu">## Results</span></span>
<span id="cb35-683"><a href="#cb35-683" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-684"><a href="#cb35-684" aria-hidden="true" tabindex="-1"></a>If the map worked, then exposure risk should predict infection in the random walkers.</span>
<span id="cb35-685"><a href="#cb35-685" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-688"><a href="#cb35-688" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-689"><a href="#cb35-689" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(rw_risk, <span class="fu">aes</span>(<span class="at">x=</span>exp_risk, <span class="at">y =</span> infected_es))<span class="sc">+</span></span>
<span id="cb35-690"><a href="#cb35-690" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">col=</span><span class="fu">factor</span>(infected_es))) <span class="sc">+</span></span>
<span id="cb35-691"><a href="#cb35-691" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">"lm"</span>) <span class="sc">+</span></span>
<span id="cb35-692"><a href="#cb35-692" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb35-693"><a href="#cb35-693" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"exposure risk"</span>, <span class="at">y =</span> <span class="st">"infected"</span>, <span class="at">col =</span> <span class="st">"infected"</span>, <span class="at">subtitle =</span> <span class="st">"exposure * susceptbility"</span>)</span>
<span id="cb35-694"><a href="#cb35-694" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-695"><a href="#cb35-695" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(rw_risk, <span class="fu">aes</span>(<span class="at">x=</span>exp_risk, <span class="at">y =</span> infected_e))<span class="sc">+</span></span>
<span id="cb35-696"><a href="#cb35-696" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">col=</span><span class="fu">factor</span>(infected_e))) <span class="sc">+</span></span>
<span id="cb35-697"><a href="#cb35-697" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">"lm"</span>) <span class="sc">+</span></span>
<span id="cb35-698"><a href="#cb35-698" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb35-699"><a href="#cb35-699" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"exposure risk"</span>, <span class="at">y =</span> <span class="st">"infected"</span>, <span class="at">col =</span> <span class="st">"infected"</span>, <span class="at">subtitle =</span> <span class="st">"exposure *  avg susceptbility"</span>)</span>
<span id="cb35-700"><a href="#cb35-700" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2 <span class="sc">+</span> <span class="fu">plot_layout</span>(<span class="at">guides =</span> <span class="st">"collect"</span>) <span class="sc">+</span> <span class="fu">plot_annotation</span>(<span class="at">title =</span> <span class="st">"Random walker infections"</span>)</span>
<span id="cb35-701"><a href="#cb35-701" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-702"><a href="#cb35-702" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-703"><a href="#cb35-703" aria-hidden="true" tabindex="-1"></a>Not great, but the infected individuals do have higher exposure risks. Let's see how it worked for the Levy-walker correlated walkers that covered much more ground.</span>
<span id="cb35-704"><a href="#cb35-704" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-707"><a href="#cb35-707" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-708"><a href="#cb35-708" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(levy_risk, <span class="fu">aes</span>(<span class="at">x=</span>exp_risk, <span class="at">y =</span> infected_es))<span class="sc">+</span></span>
<span id="cb35-709"><a href="#cb35-709" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">col=</span><span class="fu">factor</span>(infected_es))) <span class="sc">+</span></span>
<span id="cb35-710"><a href="#cb35-710" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">"lm"</span>) <span class="sc">+</span></span>
<span id="cb35-711"><a href="#cb35-711" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb35-712"><a href="#cb35-712" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"exposure risk"</span>, <span class="at">y =</span> <span class="st">"infected"</span>, <span class="at">col =</span> <span class="st">"infected"</span>, <span class="at">subtitle =</span> <span class="st">"exposure * susceptbility"</span>)</span>
<span id="cb35-713"><a href="#cb35-713" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-714"><a href="#cb35-714" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(levy_risk, <span class="fu">aes</span>(<span class="at">x=</span>exp_risk, <span class="at">y =</span> infected_e))<span class="sc">+</span></span>
<span id="cb35-715"><a href="#cb35-715" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">col=</span><span class="fu">factor</span>(infected_e))) <span class="sc">+</span></span>
<span id="cb35-716"><a href="#cb35-716" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">"lm"</span>) <span class="sc">+</span></span>
<span id="cb35-717"><a href="#cb35-717" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb35-718"><a href="#cb35-718" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"exposure risk"</span>, <span class="at">y =</span> <span class="st">"infected"</span>, <span class="at">col =</span> <span class="st">"infected"</span>, <span class="at">subtitle =</span> <span class="st">"exposure *  avg susceptbility"</span>)</span>
<span id="cb35-719"><a href="#cb35-719" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2 <span class="sc">+</span> <span class="fu">plot_layout</span>(<span class="at">guides =</span> <span class="st">"collect"</span>) <span class="sc">+</span> <span class="fu">plot_annotation</span>(<span class="at">title =</span> <span class="st">"Correlated walker infections"</span>)</span>
<span id="cb35-720"><a href="#cb35-720" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-721"><a href="#cb35-721" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-722"><a href="#cb35-722" aria-hidden="true" tabindex="-1"></a>Compare predictive accuracy between the models</span>
<span id="cb35-723"><a href="#cb35-723" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-726"><a href="#cb35-726" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-727"><a href="#cb35-727" aria-hidden="true" tabindex="-1"></a>pred_acc_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(x, infected_type){</span>
<span id="cb35-728"><a href="#cb35-728" aria-hidden="true" tabindex="-1"></a>  x<span class="sc">$</span>infected <span class="ot">&lt;-</span> x <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">any_of</span>(infected_type)) <span class="sc">%&gt;%</span> <span class="fu">pull</span>()</span>
<span id="cb35-729"><a href="#cb35-729" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb35-730"><a href="#cb35-730" aria-hidden="true" tabindex="-1"></a>  <span class="do">## binomial model</span></span>
<span id="cb35-731"><a href="#cb35-731" aria-hidden="true" tabindex="-1"></a>  mod <span class="ot">&lt;-</span> <span class="fu">glm</span>(infected <span class="sc">~</span> exp_risk, <span class="at">data =</span> x, <span class="at">family =</span> <span class="st">"binomial"</span>)</span>
<span id="cb35-732"><a href="#cb35-732" aria-hidden="true" tabindex="-1"></a>  <span class="do">## predicted prob of infection</span></span>
<span id="cb35-733"><a href="#cb35-733" aria-hidden="true" tabindex="-1"></a>  x<span class="sc">$</span>pred_prob <span class="ot">&lt;-</span> <span class="fu">predict</span>(mod, x, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb35-734"><a href="#cb35-734" aria-hidden="true" tabindex="-1"></a>  <span class="do">## if predicted prob &gt;50 say infected</span></span>
<span id="cb35-735"><a href="#cb35-735" aria-hidden="true" tabindex="-1"></a>  x<span class="sc">$</span>pred <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">*</span>(x<span class="sc">$</span>pred_prob <span class="sc">&gt;</span> .<span class="dv">5</span>)</span>
<span id="cb35-736"><a href="#cb35-736" aria-hidden="true" tabindex="-1"></a>  x<span class="sc">$</span>accurate <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">*</span>x<span class="sc">$</span>infected <span class="sc">==</span> x<span class="sc">$</span>pred</span>
<span id="cb35-737"><a href="#cb35-737" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sum</span>(x<span class="sc">$</span>accurate) <span class="sc">/</span><span class="fu">nrow</span>(x)</span>
<span id="cb35-738"><a href="#cb35-738" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-739"><a href="#cb35-739" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb35-740"><a href="#cb35-740" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-741"><a href="#cb35-741" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-742"><a href="#cb35-742" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-743"><a href="#cb35-743" aria-hidden="true" tabindex="-1"></a>The accuracy of the infection predictions should be highest in the random walk individuals with fixed susceptibility (exp_risk <span class="sc">\*</span> avg susceptibility), followed by those with random susceptibility, then correlated walkers with fixed, then random susceptibility.</span>
<span id="cb35-744"><a href="#cb35-744" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-747"><a href="#cb35-747" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-748"><a href="#cb35-748" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">walker =</span> <span class="fu">c</span>(<span class="st">"Random"</span>, <span class="st">"Random"</span>, <span class="st">"Correlated"</span>, <span class="st">"Correlated"</span>),</span>
<span id="cb35-749"><a href="#cb35-749" aria-hidden="true" tabindex="-1"></a>           <span class="at">susceptibility =</span> <span class="fu">c</span>(<span class="st">"Fixed"</span>, <span class="st">"Random"</span>, <span class="st">"Fixed"</span>, <span class="st">"Random"</span>),</span>
<span id="cb35-750"><a href="#cb35-750" aria-hidden="true" tabindex="-1"></a>           <span class="at">accuracy =</span> <span class="fu">c</span>(<span class="fu">pred_acc_fun</span>(rw_risk, <span class="st">"infected_e"</span>),</span>
<span id="cb35-751"><a href="#cb35-751" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">pred_acc_fun</span>(rw_risk, <span class="st">"infected_es"</span>),</span>
<span id="cb35-752"><a href="#cb35-752" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">pred_acc_fun</span>(levy_risk, <span class="st">"infected_e"</span>),</span>
<span id="cb35-753"><a href="#cb35-753" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">pred_acc_fun</span>(levy_risk, <span class="st">"infected_es"</span>)</span>
<span id="cb35-754"><a href="#cb35-754" aria-hidden="true" tabindex="-1"></a>                        )) <span class="sc">%&gt;%</span> </span>
<span id="cb35-755"><a href="#cb35-755" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="at">title =</span> <span class="st">"Predictive accuracy of infection probabilities"</span>)</span>
<span id="cb35-756"><a href="#cb35-756" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-757"><a href="#cb35-757" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-760"><a href="#cb35-760" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-761"><a href="#cb35-761" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false</span></span>
<span id="cb35-762"><a href="#cb35-762" aria-hidden="true" tabindex="-1"></a><span class="do">## clean up</span></span>
<span id="cb35-763"><a href="#cb35-763" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(levy_risk, indiv.risk.levy, indiv.risk.rw, p1, p2, rw_risk, sim.rw.levy, sim.rw.sfc)</span>
<span id="cb35-764"><a href="#cb35-764" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-765"><a href="#cb35-765" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-766"><a href="#cb35-766" aria-hidden="true" tabindex="-1"></a><span class="fu"># Large Simulation</span></span>
<span id="cb35-767"><a href="#cb35-767" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-768"><a href="#cb35-768" aria-hidden="true" tabindex="-1"></a>Ultimately to see how cumulative exposure risk predicts infection in people, the simulation needs to be run many times. To do that everything from the single simulation needs to be in a single function.</span>
<span id="cb35-769"><a href="#cb35-769" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-772"><a href="#cb35-772" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-773"><a href="#cb35-773" aria-hidden="true" tabindex="-1"></a>simulation_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">n_steps =</span> <span class="dv">1000</span>, <span class="at">n_individuals =</span> <span class="dv">100</span>, <span class="at">susceptibility_range =</span> <span class="fu">c</span>(<span class="fl">0.7</span>, <span class="fl">0.9</span>),</span>
<span id="cb35-774"><a href="#cb35-774" aria-hidden="true" tabindex="-1"></a>                           <span class="at">risk_landscape =</span> riskmap, <span class="at">study_area =</span> aoi, <span class="at">landscape_resistance =</span> resistance, </span>
<span id="cb35-775"><a href="#cb35-775" aria-hidden="true" tabindex="-1"></a>                           <span class="at">random_walker =</span> rand.walker, <span class="at">correlated_walker =</span> levy.walker){</span>
<span id="cb35-776"><a href="#cb35-776" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb35-777"><a href="#cb35-777" aria-hidden="true" tabindex="-1"></a>  <span class="do">## simulate movement</span></span>
<span id="cb35-778"><a href="#cb35-778" aria-hidden="true" tabindex="-1"></a>  <span class="do">### Random (brownian) walks</span></span>
<span id="cb35-779"><a href="#cb35-779" aria-hidden="true" tabindex="-1"></a>  <span class="do">## random starting coordinates</span></span>
<span id="cb35-780"><a href="#cb35-780" aria-hidden="true" tabindex="-1"></a>  start_coord <span class="ot">&lt;-</span> <span class="fu">st_sample</span>(study_area, <span class="dv">100</span>, <span class="at">type =</span> <span class="st">"random"</span>)</span>
<span id="cb35-781"><a href="#cb35-781" aria-hidden="true" tabindex="-1"></a>  start_coord <span class="ot">&lt;-</span> <span class="fu">st_coordinates</span>(start_coord)</span>
<span id="cb35-782"><a href="#cb35-782" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb35-783"><a href="#cb35-783" aria-hidden="true" tabindex="-1"></a>  <span class="do">## simulate single state walks of 1000 steps</span></span>
<span id="cb35-784"><a href="#cb35-784" aria-hidden="true" tabindex="-1"></a>  sim.rw <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb35-785"><a href="#cb35-785" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_individuals) {</span>
<span id="cb35-786"><a href="#cb35-786" aria-hidden="true" tabindex="-1"></a>    <span class="do">## simulate from location i</span></span>
<span id="cb35-787"><a href="#cb35-787" aria-hidden="true" tabindex="-1"></a>    tmp <span class="ot">&lt;-</span> <span class="fu">simulate</span>(random_walker, n_steps,</span>
<span id="cb35-788"><a href="#cb35-788" aria-hidden="true" tabindex="-1"></a>                    <span class="at">coords =</span> start_coord[i,])</span>
<span id="cb35-789"><a href="#cb35-789" aria-hidden="true" tabindex="-1"></a>    <span class="do">## save results to a list</span></span>
<span id="cb35-790"><a href="#cb35-790" aria-hidden="true" tabindex="-1"></a>    sim.rw[[i]] <span class="ot">&lt;-</span> <span class="fu">cbind</span>(tmp[,<span class="dv">1</span>], tmp[,<span class="dv">2</span>])</span>
<span id="cb35-791"><a href="#cb35-791" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb35-792"><a href="#cb35-792" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-793"><a href="#cb35-793" aria-hidden="true" tabindex="-1"></a>  <span class="do">## make in to sfc lines</span></span>
<span id="cb35-794"><a href="#cb35-794" aria-hidden="true" tabindex="-1"></a>  walks.random <span class="ot">&lt;-</span> <span class="fu">lapply</span>(sim.rw, st_linestring)</span>
<span id="cb35-795"><a href="#cb35-795" aria-hidden="true" tabindex="-1"></a>  walks.random <span class="ot">&lt;-</span> <span class="fu">st_sf</span>(<span class="at">id =</span> <span class="dv">1</span><span class="sc">:</span>n_individuals, <span class="at">geometry =</span> walks.random) <span class="sc">%&gt;%</span> </span>
<span id="cb35-796"><a href="#cb35-796" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_set_crs</span>(<span class="fu">st_crs</span>(risk_landscape))</span>
<span id="cb35-797"><a href="#cb35-797" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb35-798"><a href="#cb35-798" aria-hidden="true" tabindex="-1"></a>  <span class="do">### Levy-walker (correlated random)</span></span>
<span id="cb35-799"><a href="#cb35-799" aria-hidden="true" tabindex="-1"></a>  <span class="do">## new starting coords in areas of low resistance so don't get stuck</span></span>
<span id="cb35-800"><a href="#cb35-800" aria-hidden="true" tabindex="-1"></a>  init <span class="ot">=</span> <span class="fu">xyFromCell</span>(resistance, <span class="fu">sample</span>(<span class="fu">which</span>(<span class="fu">values</span>(resistance) <span class="sc">==</span> <span class="dv">0</span>), <span class="dv">100</span>, <span class="at">replace=</span>T))</span>
<span id="cb35-801"><a href="#cb35-801" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb35-802"><a href="#cb35-802" aria-hidden="true" tabindex="-1"></a>  <span class="do">## simulate</span></span>
<span id="cb35-803"><a href="#cb35-803" aria-hidden="true" tabindex="-1"></a>  sim.rw <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb35-804"><a href="#cb35-804" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_individuals) {</span>
<span id="cb35-805"><a href="#cb35-805" aria-hidden="true" tabindex="-1"></a>    <span class="do">## simulate from location i</span></span>
<span id="cb35-806"><a href="#cb35-806" aria-hidden="true" tabindex="-1"></a>    tmp <span class="ot">&lt;-</span> <span class="fu">simulate</span>(correlated_walker, n_steps,</span>
<span id="cb35-807"><a href="#cb35-807" aria-hidden="true" tabindex="-1"></a>                    <span class="at">resist =</span> <span class="fu">raster</span>(resistance),</span>
<span id="cb35-808"><a href="#cb35-808" aria-hidden="true" tabindex="-1"></a>                    <span class="at">coords =</span> init[i,])</span>
<span id="cb35-809"><a href="#cb35-809" aria-hidden="true" tabindex="-1"></a>    <span class="do">## save results to a list</span></span>
<span id="cb35-810"><a href="#cb35-810" aria-hidden="true" tabindex="-1"></a>    sim.rw[[i]] <span class="ot">&lt;-</span> <span class="fu">cbind</span>(tmp[,<span class="dv">1</span>], tmp[,<span class="dv">2</span>])</span>
<span id="cb35-811"><a href="#cb35-811" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb35-812"><a href="#cb35-812" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb35-813"><a href="#cb35-813" aria-hidden="true" tabindex="-1"></a>  <span class="do">## make in to sfc lines</span></span>
<span id="cb35-814"><a href="#cb35-814" aria-hidden="true" tabindex="-1"></a>  walks.corr <span class="ot">&lt;-</span> <span class="fu">lapply</span>(sim.rw, st_linestring)</span>
<span id="cb35-815"><a href="#cb35-815" aria-hidden="true" tabindex="-1"></a>  walks.corr <span class="ot">&lt;-</span> <span class="fu">st_sf</span>(<span class="at">id =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>, <span class="at">geometry =</span> walks.corr) <span class="sc">%&gt;%</span> </span>
<span id="cb35-816"><a href="#cb35-816" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_set_crs</span>(<span class="fu">st_crs</span>(risk_landscape))</span>
<span id="cb35-817"><a href="#cb35-817" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb35-818"><a href="#cb35-818" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Calculate cumulative exposure risk/individual</span></span>
<span id="cb35-819"><a href="#cb35-819" aria-hidden="true" tabindex="-1"></a>  <span class="do">### random walkers</span></span>
<span id="cb35-820"><a href="#cb35-820" aria-hidden="true" tabindex="-1"></a>  indiv.risk.random <span class="ot">&lt;-</span> <span class="fu">measure_risk</span>(<span class="at">walker =</span> walks.random, <span class="at">riskmap =</span> risk_landscape, <span class="at">nsteps =</span> n_steps)</span>
<span id="cb35-821"><a href="#cb35-821" aria-hidden="true" tabindex="-1"></a>  <span class="do">### correlated random walkers</span></span>
<span id="cb35-822"><a href="#cb35-822" aria-hidden="true" tabindex="-1"></a>  indiv.risk.corr <span class="ot">&lt;-</span> <span class="fu">measure_risk</span>(<span class="at">walker =</span> walks.corr, <span class="at">riskmap =</span> risk_landscape, <span class="at">nsteps =</span> n_steps)</span>
<span id="cb35-823"><a href="#cb35-823" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb35-824"><a href="#cb35-824" aria-hidden="true" tabindex="-1"></a>  <span class="do">## assign susceptibility</span></span>
<span id="cb35-825"><a href="#cb35-825" aria-hidden="true" tabindex="-1"></a>  susceptibility <span class="ot">=</span> <span class="fu">runif</span>(<span class="dv">100</span>, susceptibility_range[<span class="dv">1</span>], susceptibility_range[<span class="dv">2</span>])</span>
<span id="cb35-826"><a href="#cb35-826" aria-hidden="true" tabindex="-1"></a>  mean_suscept <span class="ot">=</span> <span class="fu">mean</span>(susceptibility)</span>
<span id="cb35-827"><a href="#cb35-827" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb35-828"><a href="#cb35-828" aria-hidden="true" tabindex="-1"></a>  <span class="do">## determine infections</span></span>
<span id="cb35-829"><a href="#cb35-829" aria-hidden="true" tabindex="-1"></a>  <span class="do">## make a dataframe for the outcomes --- random walkers</span></span>
<span id="cb35-830"><a href="#cb35-830" aria-hidden="true" tabindex="-1"></a>  indiv.risk.random <span class="ot">&lt;-</span> <span class="fu">cbind</span>(indiv.risk.random,</span>
<span id="cb35-831"><a href="#cb35-831" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">data.frame</span>( <span class="at">susceptibility =</span> susceptibility)) <span class="sc">%&gt;%</span></span>
<span id="cb35-832"><a href="#cb35-832" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb35-833"><a href="#cb35-833" aria-hidden="true" tabindex="-1"></a>    <span class="do">## predict infections based on exposure risk</span></span>
<span id="cb35-834"><a href="#cb35-834" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">infected_es =</span> <span class="fu">rbinom</span>(<span class="dv">1</span>, <span class="dv">1</span>, exp_risk <span class="sc">*</span> susceptibility ), <span class="co"># sum(exp_risk * susceptibility)</span></span>
<span id="cb35-835"><a href="#cb35-835" aria-hidden="true" tabindex="-1"></a>           <span class="at">infected_e =</span> <span class="fu">rbinom</span>(<span class="dv">1</span>, <span class="dv">1</span>, exp_risk <span class="sc">*</span> mean_suscept)) <span class="co"># sum(exposure risk) alone</span></span>
<span id="cb35-836"><a href="#cb35-836" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb35-837"><a href="#cb35-837" aria-hidden="true" tabindex="-1"></a>  <span class="do">## make a dataframe for the outcomes --- levy walkers</span></span>
<span id="cb35-838"><a href="#cb35-838" aria-hidden="true" tabindex="-1"></a>  indiv.risk.corr <span class="ot">&lt;-</span> <span class="fu">cbind</span>(indiv.risk.corr,</span>
<span id="cb35-839"><a href="#cb35-839" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">data.frame</span>( <span class="at">susceptibility =</span> susceptibility)) <span class="sc">%&gt;%</span></span>
<span id="cb35-840"><a href="#cb35-840" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb35-841"><a href="#cb35-841" aria-hidden="true" tabindex="-1"></a>    <span class="do">## predict infections based on exposure risk</span></span>
<span id="cb35-842"><a href="#cb35-842" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">infected_es =</span> <span class="fu">rbinom</span>(<span class="dv">1</span>, <span class="dv">1</span>, exp_risk <span class="sc">*</span> susceptibility ), <span class="co"># sum(exp_risk * susceptibility)</span></span>
<span id="cb35-843"><a href="#cb35-843" aria-hidden="true" tabindex="-1"></a>           <span class="at">infected_e =</span> <span class="fu">rbinom</span>(<span class="dv">1</span>, <span class="dv">1</span>, exp_risk <span class="sc">*</span> mean_suscept)) <span class="co"># sum(exposure risk) alone</span></span>
<span id="cb35-844"><a href="#cb35-844" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-845"><a href="#cb35-845" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb35-846"><a href="#cb35-846" aria-hidden="true" tabindex="-1"></a>  <span class="do">## output predictive accuracy</span></span>
<span id="cb35-847"><a href="#cb35-847" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(<span class="at">walker =</span> <span class="fu">c</span>(<span class="st">"Random"</span>, <span class="st">"Random"</span>, <span class="st">"Correlated"</span>, <span class="st">"Correlated"</span>),</span>
<span id="cb35-848"><a href="#cb35-848" aria-hidden="true" tabindex="-1"></a>           <span class="at">susceptibility =</span> <span class="fu">c</span>(<span class="st">"Fixed"</span>, <span class="st">"Random"</span>, <span class="st">"Fixed"</span>, <span class="st">"Random"</span>),</span>
<span id="cb35-849"><a href="#cb35-849" aria-hidden="true" tabindex="-1"></a>           <span class="at">accuracy =</span> <span class="fu">c</span>(<span class="fu">pred_acc_fun</span>(indiv.risk.random, <span class="st">"infected_e"</span>),</span>
<span id="cb35-850"><a href="#cb35-850" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">pred_acc_fun</span>(indiv.risk.random, <span class="st">"infected_es"</span>),</span>
<span id="cb35-851"><a href="#cb35-851" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">pred_acc_fun</span>(indiv.risk.corr, <span class="st">"infected_e"</span>),</span>
<span id="cb35-852"><a href="#cb35-852" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">pred_acc_fun</span>(indiv.risk.corr, <span class="st">"infected_es"</span>)</span>
<span id="cb35-853"><a href="#cb35-853" aria-hidden="true" tabindex="-1"></a>                        ))</span>
<span id="cb35-854"><a href="#cb35-854" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb35-855"><a href="#cb35-855" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-856"><a href="#cb35-856" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-857"><a href="#cb35-857" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-858"><a href="#cb35-858" aria-hidden="true" tabindex="-1"></a>Check that the function works when run one time. By default the simulation uses the riskmap, aoi, resistance raster, and random and levy walker walks set up previously. The default number of steps in each walk is 1000, for 100 individuals, with susceptibility <span class="sc">\[</span>0.7, 0.9<span class="sc">\]</span> as used previously.</span>
<span id="cb35-859"><a href="#cb35-859" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-862"><a href="#cb35-862" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-863"><a href="#cb35-863" aria-hidden="true" tabindex="-1"></a><span class="do">## check it works running one time</span></span>
<span id="cb35-864"><a href="#cb35-864" aria-hidden="true" tabindex="-1"></a><span class="fu">simulation_fun</span>() <span class="sc">%&gt;%</span> knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="at">title =</span> <span class="st">"Results of one simulation using the function"</span>)</span>
<span id="cb35-865"><a href="#cb35-865" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-866"><a href="#cb35-866" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-867"><a href="#cb35-867" aria-hidden="true" tabindex="-1"></a>Then run the function 100 times.</span>
<span id="cb35-868"><a href="#cb35-868" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-871"><a href="#cb35-871" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-872"><a href="#cb35-872" aria-hidden="true" tabindex="-1"></a><span class="do">## fun the function many times</span></span>
<span id="cb35-873"><a href="#cb35-873" aria-hidden="true" tabindex="-1"></a>lg_sim <span class="ot">&lt;-</span> <span class="fu">replicate</span>(<span class="dv">100</span>, <span class="fu">simulation_fun</span>(), <span class="at">simplify =</span> F)</span>
<span id="cb35-874"><a href="#cb35-874" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-875"><a href="#cb35-875" aria-hidden="true" tabindex="-1"></a><span class="do">## make the output into one large dataframe</span></span>
<span id="cb35-876"><a href="#cb35-876" aria-hidden="true" tabindex="-1"></a>lg_sim <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(lg_sim)</span>
<span id="cb35-877"><a href="#cb35-877" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-878"><a href="#cb35-878" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-879"><a href="#cb35-879" aria-hidden="true" tabindex="-1"></a>The distributions of the accuracy of models that use cumulative exposure to predict infection show that as expected random walkers infections are predicted with higher accuracy, and that the effect of variable susceptibility to infection in each individual lower the accuracy of correlated walks more than random walks.</span>
<span id="cb35-880"><a href="#cb35-880" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-883"><a href="#cb35-883" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-884"><a href="#cb35-884" aria-hidden="true" tabindex="-1"></a><span class="do">## plot the distribution of predictive values between the fix susceptibility random and correlated walks</span></span>
<span id="cb35-885"><a href="#cb35-885" aria-hidden="true" tabindex="-1"></a>lg_sim <span class="sc">%&gt;%</span> </span>
<span id="cb35-886"><a href="#cb35-886" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>accuracy, <span class="at">fill=</span>walker)) <span class="sc">+</span></span>
<span id="cb35-887"><a href="#cb35-887" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">adjust =</span><span class="fl">1.5</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb35-888"><a href="#cb35-888" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">"Pastel1"</span>)<span class="sc">+</span></span>
<span id="cb35-889"><a href="#cb35-889" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>susceptibility, <span class="at">ncol=</span><span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb35-890"><a href="#cb35-890" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Accuracy of Infection Estimates"</span>,</span>
<span id="cb35-891"><a href="#cb35-891" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Fixed vs random susceptibility"</span>,</span>
<span id="cb35-892"><a href="#cb35-892" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">"Walk type"</span>)</span>
<span id="cb35-893"><a href="#cb35-893" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-894"><a href="#cb35-894" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-895"><a href="#cb35-895" aria-hidden="true" tabindex="-1"></a>The predictive accuracy of the simulations that used the fixed susceptibility values for all individuals (infection is only related to cumulative exposure risk) is significantly higher in random walkers then correlated walkers.</span>
<span id="cb35-896"><a href="#cb35-896" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-899"><a href="#cb35-899" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-900"><a href="#cb35-900" aria-hidden="true" tabindex="-1"></a><span class="do">## plot the distribution of predictive values between the fix susceptibility random and correlated walks</span></span>
<span id="cb35-901"><a href="#cb35-901" aria-hidden="true" tabindex="-1"></a>lg_sim <span class="sc">%&gt;%</span> </span>
<span id="cb35-902"><a href="#cb35-902" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(susceptibility <span class="sc">==</span> <span class="st">"Fixed"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb35-903"><a href="#cb35-903" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>accuracy, <span class="at">fill=</span>walker)) <span class="sc">+</span></span>
<span id="cb35-904"><a href="#cb35-904" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">adjust =</span><span class="fl">1.5</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb35-905"><a href="#cb35-905" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">"Pastel1"</span>)<span class="sc">+</span></span>
<span id="cb35-906"><a href="#cb35-906" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Accuracy of Infection ~ Cummulative Exposure"</span>)</span>
<span id="cb35-907"><a href="#cb35-907" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb35-908"><a href="#cb35-908" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-909"><a href="#cb35-909" aria-hidden="true" tabindex="-1"></a><span class="do">## test if significantly different</span></span>
<span id="cb35-910"><a href="#cb35-910" aria-hidden="true" tabindex="-1"></a>lg_sim <span class="sc">%&gt;%</span> </span>
<span id="cb35-911"><a href="#cb35-911" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(susceptibility <span class="sc">==</span> <span class="st">"Fixed"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb35-912"><a href="#cb35-912" aria-hidden="true" tabindex="-1"></a>  <span class="fu">t.test</span>(accuracy <span class="sc">~</span> walker, <span class="at">data =</span> ., <span class="at">var.equal =</span> <span class="cn">TRUE</span>)</span>
<span id="cb35-913"><a href="#cb35-913" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-914"><a href="#cb35-914" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-915"><a href="#cb35-915" aria-hidden="true" tabindex="-1"></a>The same effect is seen in the randomly assigned individual susceptibility random and correlated walkers.</span>
<span id="cb35-916"><a href="#cb35-916" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-919"><a href="#cb35-919" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb35-920"><a href="#cb35-920" aria-hidden="true" tabindex="-1"></a><span class="do">## plot the distributions of predictive values between the variable susceptibility random and correlated walks</span></span>
<span id="cb35-921"><a href="#cb35-921" aria-hidden="true" tabindex="-1"></a>lg_sim <span class="sc">%&gt;%</span> </span>
<span id="cb35-922"><a href="#cb35-922" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(susceptibility <span class="sc">==</span> <span class="st">"Random"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb35-923"><a href="#cb35-923" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>accuracy, <span class="at">fill=</span>walker)) <span class="sc">+</span></span>
<span id="cb35-924"><a href="#cb35-924" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">adjust =</span><span class="fl">1.5</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb35-925"><a href="#cb35-925" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">"Pastel1"</span>)<span class="sc">+</span></span>
<span id="cb35-926"><a href="#cb35-926" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Accuracy of Infection ~ Cummulative Exposure*Susceptibility"</span>)</span>
<span id="cb35-927"><a href="#cb35-927" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb35-928"><a href="#cb35-928" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-929"><a href="#cb35-929" aria-hidden="true" tabindex="-1"></a><span class="do">## test if significantly different</span></span>
<span id="cb35-930"><a href="#cb35-930" aria-hidden="true" tabindex="-1"></a>lg_sim <span class="sc">%&gt;%</span> </span>
<span id="cb35-931"><a href="#cb35-931" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(susceptibility <span class="sc">==</span> <span class="st">"Random"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb35-932"><a href="#cb35-932" aria-hidden="true" tabindex="-1"></a>  <span class="fu">t.test</span>(accuracy <span class="sc">~</span> walker, <span class="at">data =</span> ., <span class="at">var.equal =</span> <span class="cn">TRUE</span>)</span>
<span id="cb35-933"><a href="#cb35-933" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-934"><a href="#cb35-934" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-935"><a href="#cb35-935" aria-hidden="true" tabindex="-1"></a><span class="fu"># Conclusion</span></span>
<span id="cb35-936"><a href="#cb35-936" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-937"><a href="#cb35-937" aria-hidden="true" tabindex="-1"></a>To wrap up the simulation showed that predicting individual infection probability as defined by their cumulative exposure risk, is influence by the amount of noise in that dataset such as we would expect to observe due to variability in individual's susceptibility to infection. Future directions include rerunning this simulation over different susceptibility windows and using predictors that correlate with, but are not the 'real' risk landscape.</span>
<span id="cb35-938"><a href="#cb35-938" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-939"><a href="#cb35-939" aria-hidden="true" tabindex="-1"></a><span class="fu"># References</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">Copyright 2023, Kayla Kauffman</div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>



</body></html>